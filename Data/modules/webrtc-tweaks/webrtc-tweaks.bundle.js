!function(){"use strict";const e="webrtc-tweaks",t="WEBRTC-TWEAKS",i="WebRTCTweaks |";let o=console.debug.bind(console,i),n=console.info.bind(console,i);const s=console.warn.bind(console,i);console.error.bind(console,i);const a=debounce((()=>window.location.reload()),100);function c(){if(!(game instanceof Game))throw new Error("Game is not yet initialized.");return game}function l(){var s,l;s={name:"debug",scope:"world",config:!0,default:!1,type:Boolean,onChange:()=>a()},c().settings.register(e,s.name,{name:`${t}.${s.name}`,hint:`${t}.${s.name}Hint`,scope:s.scope,config:s.config,default:s.default,type:s.type,range:s.range,onChange:s.onChange}),(l=!0===c().settings.get(e,"debug"))?(o=console.debug.bind(console,i),n=console.info.bind(console,i)):(o=()=>{},n=()=>{}),Hooks.callAll("webrtc-tweaksDebugSet",l)}class r{static isVersion9(){return isNewerVersion(c().version||c().data.version,"9")}static addPositionButton(e,t){if(1!==e.length)return void s("Can't find CameraView toggle-popout element",e);const i=$('<a class="av-control toggle" title="Change Position"><i class="fas fa-arrows-alt"></i></a>');i.on("click",(e=>r.onPositionButtonClicked(e,t))),e.after(i)}static cameraViewHeightToWidth(e){return 4/3*(e-32.5)}static cameraViewMaxWidth(e){let t=320;switch(e){case"large":t=320;break;case"medium":t=240;break;case"small":t=160}return t}static cameraViewsWidthFromWindowHeight(e,t){let i=(ui.hotbar?.element.offset()?.top||0)-((ui.nav?.element.offset()?.top||0)+(ui.nav?.element.height()||0)+4);if(!t){i-=(ui.players?.element.height()||0)-(ui.hotbar?.element.height()||0)+4}const o=i/e-4;return this.cameraViewHeightToWidth(o)}static async onCollapseSceneNavigation(){await new Promise((e=>setTimeout(e,300))),ui.webrtc&&r.setStyle(ui.webrtc,ui.webrtc?.element)}static onCollapseSidebar(){ui.webrtc&&r.setStyle(ui.webrtc,ui.webrtc?.element)}static onPositionButtonClicked(e,t){const i=t,o=["top","right","bottom","left"],n=o.indexOf(t.webrtc?.settings.client.dockPosition||"bottom"),s=n+1>=o.length?0:n+1;i.webrtc&&(i.webrtc.settings.client.dockPosition=o[s]),i.render(!0)}static onRenderCameraViews(e,t){const i=t.find(`[data-user="${c().user?.id}"]`).find('[data-action="toggle-popout"]');r.addPositionButton(i,e),r.setStyle(e,t)}static onResize(){ui.webrtc&&r.setStyle(ui.webrtc,ui.webrtc?.element)}static setLeft(e){let t=ui.sidebar?.element.offset()?.left;const i=e.width();t&&i&&(t-=i+4),t&&e.offset({left:t})}static setStyle(e,t){const i=e.webrtc?.settings.client;if(!i)return void s("Cannot find WebRTC Client settings; skipping setStyle");const{dockPosition:o}=i;switch(o){case"left":this.setTop(t,o),this.setWidth(e,t);break;case"top":this.setTop(t,o);break;case"right":this.setTop(t,o),this.setWidth(e,t),this.setLeft(t);break;case"bottom":this.setBottom(t)}}static setBottom(e){if(this.isVersion9()){const t=document.getElementById("ui-bottom");t&&e.prependTo(t)}}static setTop(e,t){if(this.isVersion9()){const t=document.getElementById("ui-top");t&&e.appendTo(t)}else{let i=ui.nav?.element.offset()?.top;if(!i)return void s("Unable to determine top position; skipping setTops");if(ui.nav?.element.hasClass("collapsed")||ui.sidebar?.element.hasClass("collapsed")&&"right"===t){if("right"!==t){const e=ui.nav?.element.find("#nav-toggle"),t=e?.height();t&&(i+=t+10)}}else{const e=ui.nav?.element.height();e&&(i+=e)}e.offset({top:i})}}static setWidth(e,t){let i=!0;"left"===e.webrtc?.settings.client.dockPosition&&(i=e.webrtc.settings.client.hidePlayerList);const o=this.cameraViewsWidthFromWindowHeight(t.children().length,i);o<this.cameraViewMaxWidth(e.webrtc?.settings.client.dockSize)&&t.width(o)}}Hooks.once("init",(()=>{l()})),Hooks.on("setup",(()=>{Hooks.on("renderCameraViews",r.onRenderCameraViews),Hooks.on("collapseSidebar",r.onCollapseSidebar),Hooks.on("sidebarCollapse",r.onCollapseSidebar),Hooks.on("collapseSceneNavigation",r.onCollapseSceneNavigation),window.addEventListener("resize",r.onResize)}))}();
//# sourceMappingURL=webrtc-tweaks.bundle.js.map