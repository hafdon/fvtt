{"version":3,"file":"one-journal.js","sources":["../src/module/settings.ts","../src/module/util.ts","../src/module/journalShell.ts","../src/one-journal.ts"],"sourcesContent":["export const MODULE_NAME = \"one-journal\"; // TODO: Better handling\n\nexport enum settings {\n  OPEN_BUTTON_IN_DIRECTORY = \"openButtonInSidebarDirectory\",\n  USE_ONE_JOURNAL = \"useOneJournal\",\n  SIDEBAR_MODE = \"sideBarMode\",\n  GM_ONLY = \"gmOnly\",\n  SYNC_SIDEBAR = \"sidebarSync\",\n  FOLDER_SELECTOR = \"folderSelector\",\n  NO_DUPLICATE_HISTORY = \"noDuplicateHistory\",\n  SIDEBAR_FOLDER_COLOR = \"sideBarFolderColor\",\n  SIDEBAR_DISABLE_PLAYER = \"sideBarDisablePlayer\",\n  SIDEBAR_COLLAPSED = \"sideBarCollapsed\",\n  USE_BROWSER_HISTORY = \"useBrowserHistory\",\n  DBL_CLICK_EDIT = \"dblClickEdit\",\n  SIDEBAR_WIDTH = \"sidebarWidth\",\n  SIDEBAR_COMPACT = \"sidebarCompact\",\n}\n\ninterface ICallbacks {\n  [setting: string]: (value: any) => void;\n}\n\nconst noop = () => {};\n\ninterface ModuleSetting {\n  setting: settings;\n  /** Name of the setting that shows up in the list */\n  name: string;\n  /** Longer description of the setting that shows up in the list */\n  hint: string;\n  type: any;\n  /** Default value */\n  default: any;\n  /** Creates a multiple choice dropdown with key: value */\n  choices?: Object;\n  /** Setting should show up in the settings window */\n  config?: boolean;\n  /** What scope the setting is saved in */\n  scope?: \"client\" | \"world\";\n}\n\nconst moduleSettings: ModuleSetting[] = [\n  {\n    setting: settings.USE_ONE_JOURNAL,\n    name: \"ONEJOURNAL.SettingsUseOneJournal\",\n    hint: \"ONEJOURNAL.SettingsUseOneJournalHint\",\n    type: Boolean,\n    default: true,\n  },\n  {\n    setting: settings.OPEN_BUTTON_IN_DIRECTORY,\n    name: \"ONEJOURNAL.SettingsOpenButtonInSidebarDirectory\",\n    hint: \"ONEJOURNAL.SettingsOpenButtonInSidebarDirectoryHint\",\n    type: Boolean,\n    default: false,\n  },\n  {\n    setting: settings.SIDEBAR_MODE,\n    name: \"ONEJOURNAL.SettingsSidebarMode\",\n    hint: \"ONEJOURNAL.SettingsSidebarModeHint\",\n    type: String,\n    choices: {\n      right: \"ONEJOURNAL.SettingsSidebarModeRight\",\n      left: \"ONEJOURNAL.SettingsSidebarModeLeft\",\n    },\n    default: \"right\",\n  },\n  {\n    setting: settings.SIDEBAR_COLLAPSED,\n    name: \"Sidebar is collapsed\",\n    hint: \"This option should not show up in the settings window\",\n    type: Boolean,\n    default: false,\n    config: false, // Doesn't show up in config\n  },\n  {\n    setting: settings.SIDEBAR_FOLDER_COLOR,\n    name: \"ONEJOURNAL.SettingsSidebarFolderColor\",\n    hint: \"ONEJOURNAL.SettingsSidebarFolderColorHint\",\n    type: Boolean,\n    default: false,\n  },\n  {\n    setting: settings.SYNC_SIDEBAR,\n    name: \"ONEJOURNAL.SettingsSidebarSync\",\n    hint: \"ONEJOURNAL.SettingsSidebarSyncHint\",\n    type: Boolean,\n    default: true,\n  },\n  {\n    setting: settings.SIDEBAR_WIDTH,\n    name: \"ONEJOURNAL.SettingsSidebarWidth\",\n    hint: \"ONEJOURNAL.SettingsSidebarWidthHint\",\n    type: Number,\n    choices: {\n      150: \"ONEJOURNAL.SettingsSidebarWidthTiny\",\n      230: \"ONEJOURNAL.SettingsSidebarWidthSmall\",\n      275: \"ONEJOURNAL.SettingsSidebarWidthReduced\",\n      300: \"ONEJOURNAL.SettingsSidebarWidthNormal\",\n      336: \"ONEJOURNAL.SettingsSidebarWidthWide\",\n    },\n    default: 300,\n  },\n  {\n    setting: settings.SIDEBAR_COMPACT,\n    name: \"ONEJOURNAL.SettingsSidebarCompact\",\n    hint: \"ONEJOURNAL.SettingsSidebarCompactHint\",\n    type: Boolean,\n    default: false,\n  },\n  {\n    setting: settings.FOLDER_SELECTOR,\n    name: \"ONEJOURNAL.SettingsFolderSelector\",\n    hint: \"ONEJOURNAL.SettingsFolderSelectorHint\",\n    type: Boolean,\n    default: false,\n  },\n  {\n    setting: settings.DBL_CLICK_EDIT,\n    name: \"ONEJOURNAL.SettingsDblClickEdit\",\n    hint: \"ONEJOURNAL.SettingsDblClickEditHint\",\n    type: Boolean,\n    default: true,\n  },\n  {\n    setting: settings.NO_DUPLICATE_HISTORY,\n    name: \"ONEJOURNAL.SettingsNoDuplicateHistory\",\n    hint: \"ONEJOURNAL.SettingsNoDuplicateHistoryHint\",\n    type: Boolean,\n    default: false,\n  },\n  {\n    setting: settings.USE_BROWSER_HISTORY,\n    name: \"ONEJOURNAL.SettingsUseBrowserHistoryExperimental\",\n    hint: \"ONEJOURNAL.SettingsUseBrowserHistoryHint\",\n    type: Boolean,\n    default: false,\n  },\n  {\n    setting: settings.SIDEBAR_DISABLE_PLAYER,\n    name: \"ONEJOURNAL.SettingsSidebarDisablePlayer\",\n    hint: \"ONEJOURNAL.SettingsSidebarDisablePlayerHint\",\n    type: Boolean,\n    default: false,\n    scope: \"world\",\n  },\n  {\n    setting: settings.GM_ONLY,\n    name: \"ONEJOURNAL.SettingsGMOnly\",\n    hint: \"ONEJOURNAL.SettingsGMOnlyHint\",\n    type: Boolean,\n    default: false,\n    scope: \"world\",\n  },\n];\n\nfunction registerSetting(callbacks: ICallbacks, { setting, ...options }) {\n  game.settings.register(MODULE_NAME, setting, {\n    config: true,\n    scope: \"client\",\n    ...options,\n    onChange: callbacks[setting] || noop,\n  });\n}\n\nexport function registerSettings(callbacks: ICallbacks = {}) {\n  moduleSettings.forEach(item => {\n    registerSetting(callbacks, item);\n  });\n}\n\nexport function getSetting(setting: settings) {\n  return game.settings.get(MODULE_NAME, setting as string);\n}\n\nexport function setSetting(setting: settings, value: any) {\n  return game.settings.set(MODULE_NAME, setting as string, value);\n}\n","export const i18n = name => game.i18n.localize(`ONEJOURNAL.${name}`);\n\nexport function scrollElementIntoView(\n  element: JQuery<HTMLElement>,\n  scrollable: JQuery<HTMLElement>\n) {\n  if (!element.offset()) {\n    return;\n  }\n  const topOffset = scrollable.offset().top;\n  const elementTop = element.offset().top - topOffset;\n  const elementBottom = elementTop + element.height();\n\n  if (elementTop < 1) {\n    // element is above fold\n    scrollable.scrollTop(\n      element.offset().top - topOffset + scrollable.scrollTop()\n    );\n  }\n\n  if (elementBottom > scrollable.height()) {\n    // element is below fold\n    scrollable.scrollTop(\n      element.offset().top -\n        topOffset +\n        scrollable.scrollTop() -\n        scrollable.height() +\n        element.outerHeight()\n    );\n  }\n}\n","import { getSetting, setSetting, settings } from \"./settings.js\";\nimport { i18n, scrollElementIntoView } from \"./util.js\";\n\ninterface IHistoryItem {\n  id: string;\n  title?: string;\n  hash: string;\n}\n\nexport class JournalShell extends Application {\n  _state: number;\n\n  get element(): JQuery<HTMLElement> {\n    return super.element as JQuery<HTMLElement>;\n  }\n\n  get document(): Document {\n    return this.element.get(0).ownerDocument;\n  }\n\n  directory: OneJournalDirectory;\n  attachedId: number = -1;\n  attachedUid: string;\n  history: IHistoryItem[] = [];\n  historyFwd: IHistoryItem[] = [];\n  historySeq = 0;\n  contextMenu: ContextMenu;\n  detachedJournals: Set<string> = new Set();\n  swappingJournals: Set<string> = new Set();\n\n  constructor() {\n    super({\n      id: \"OneJournalShell\",\n      template: \"modules/one-journal/templates/shell.html\",\n      title: \"OneJournal\",\n      classes: [`oj-${game.system.id}`],\n      popOut: true,\n      resizable: true,\n      width: 850,\n      height: 600,\n    });\n\n    window.onhashchange = e => {\n      if (getSetting(settings.USE_BROWSER_HISTORY) !== true) return;\n      const hash = window.location.hash;\n      const i = this.history.findIndex(item => item.hash === hash);\n      if (i !== -1) {\n        this.goToHistoryByIndex(i);\n      } else {\n        const i = this.historyFwd.findIndex(item => item.hash === hash);\n        if (i === -1) return;\n        this.goToHistoryFwdByIndex(i);\n      }\n    };\n\n    this.directory = new OneJournalDirectory(this);\n  }\n\n  open(attachApp: JournalSheet) {\n    if (attachApp && this.detachedJournals.has(attachApp.entity.uuid)) {\n      return;\n    }\n    this.render(true, { attachApp });\n  }\n\n  render(force?: boolean, options: any = {}): Application {\n    const { attachApp, ...rest } = options;\n\n    if (this._state <= 0) {\n      Hooks.once(\"render\" + this.constructor.name, () => {\n        Hooks.once(\"render\" + this.directory.constructor.name, () => {\n          return this.onRenderComplete(attachApp);\n        });\n      });\n      return super.render(force, rest) as JournalShell;\n    } else {\n      if (attachApp) {\n        this.attach(attachApp);\n      }\n    }\n    return this;\n  }\n\n  toggleSidebar(): void {\n    this.element.toggleClass(\"sidebar-mode-none\");\n    setSetting(\n      settings.SIDEBAR_COLLAPSED,\n      !getSetting(settings.SIDEBAR_COLLAPSED)\n    );\n  }\n\n  async onRenderComplete(attachApp?: any) {\n    if (attachApp) {\n      this.attach(attachApp);\n    }\n    const sidebarDisabled =\n      !game.user.isGM && getSetting(settings.SIDEBAR_DISABLE_PLAYER);\n\n    if (sidebarDisabled) {\n      this.element.find(\".one-journal-shell > .sidebar-toggle\").remove();\n      this.element.addClass(\"sidebar-disabled\");\n    } else {\n      this.element\n        .find(\".one-journal-shell > .sidebar-toggle\")\n        .click(() => this.toggleSidebar());\n    }\n\n    if (getSetting(settings.SIDEBAR_COLLAPSED) === true || sidebarDisabled) {\n      this.element.addClass(\"sidebar-mode-none\");\n    }\n  }\n\n  async close(): Promise<any> {\n    // @ts-ignore\n    const attachedClose = ui.windows[this.attachedId]?.close();\n\n    this.restoreMaximized();\n    await Promise.all([\n      attachedClose,\n      this.directory.close(true),\n      super.close(),\n    ]);\n  }\n\n  async minimize(): Promise<boolean> {\n    this.restoreMaximized();\n    return super.minimize();\n  }\n\n  activateListeners(html: JQuery) {\n    const header = this.element.children(\".window-header\");\n    const close = header.find(\".close\");\n    close.attr(\"title\", i18n(\"ApplicationExitTitle\"));\n    close.contents().last().replaceWith(i18n(\"ApplicationExit\"));\n    header.children().wrapAll(`<div class=\"one-journal-header\" />`);\n    this.directory.render(true);\n    this.element.find(\".sub-mode-toggle\").click(() => {\n      this.toggleSubMode();\n    });\n    this.element\n      .find(\".history-navigation .forward\")\n      .click(() => this.forward());\n    this.element\n      .find(\".history-navigation .backward\")\n      .click(() => this.backward());\n\n    this.changeSidebarMode(getSetting(settings.SIDEBAR_MODE));\n    this.setSidebarWidth(getSetting(settings.SIDEBAR_WIDTH));\n\n    this._historyContextMenu(html);\n  }\n\n  attach(app: BaseEntitySheet) {\n    if (\n      app.appId == this.attachedId ||\n      this.detachedJournals.has(app.entity.uuid)\n    ) {\n      return;\n    }\n    if (this.attachedId != -1) {\n      // @ts-ignore\n      ui.windows[this.attachedId]?.close();\n    }\n\n    this.attachedId = app.appId;\n    this.attachedUid = app.entity.uuid;\n    this.element.addClass(\"journal-attached\");\n    if (getSetting(settings.FOLDER_SELECTOR) === true) {\n      this.element.addClass(\"show-folder-select\");\n    }\n    (app.element as JQuery).addClass(\"one-journal-attached\");\n\n    // Check if element is open in another window (PopOut!)\n    if (this.document != document) {\n      this.document.adoptNode((app.element as JQuery).get(0));\n    }\n    this.element.find(\".shell-content\").append(app.element);\n    const headerContents = (app.element as JQuery)\n      .find(\".window-header > *\")\n      .detach();\n    if (headerContents.length > 0) {\n      const header = this.element.children(\".window-header\");\n      header.children(\":not(.one-journal-header)\").remove();\n      header.prepend(headerContents);\n      header\n        .children(\".header-button\")\n        .removeClass(\"header-button\")\n        .addClass(\"journal-header-button\")\n        .on(\"click\", e => {\n          //@ts-ignore\n          const buttons = app._getHeaderButtons();\n          e.preventDefault();\n          const button = buttons.find(b =>\n            (e.currentTarget as HTMLElement).classList.contains(b.class)\n          );\n          button.onclick(e);\n        });\n    }\n\n    this.directory.selected(this.attachedUid);\n    this.navigated(app);\n\n    // @ts-ignore\n    let minimized = app._minimized;\n    if (minimized) {\n      // @ts-ignore\n      app.maximize();\n      this.minimize();\n    }\n  }\n\n  detach(app: JournalSheet) {\n    if (!this.swappingJournals.delete(app.entity.uuid)) {\n      if (this.detachedJournals.delete(app.entity.uuid)) {\n        this.directory.render(true);\n      }\n    }\n    if (this.attachedId === app.appId) {\n      this.element.removeClass(\"journal-attached\");\n      this.element\n        .children(\".window-header\")\n        .children(\":not(.one-journal-header)\")\n        .remove();\n      app.close();\n      this.attachedId = -1;\n      this.directory.deselected();\n    }\n  }\n\n  async openDetached(uuid: string): Promise<void> {\n    if (this.attachedUid === uuid) {\n      //@ts-ignore\n      ui.windows[this.attachedId]?.close();\n      await new Promise(r => setTimeout(r, 300));\n      this.detachedJournals.add(uuid);\n    } else {\n      this.detachedJournals.add(uuid);\n    }\n    this.directory.render(true);\n    const e = await fromUuid(uuid);\n    e.sheet.render(true);\n  }\n\n  fullScreen() {\n    if (this.element.hasClass(\"maximized\")) {\n      this.element.removeClass(\"maximized\");\n      this.element\n        .find(\".maximize-toggle\")\n        .contents()\n        .last()[0].textContent = i18n(\"ApplicationMaximize\");\n      this.element\n        .find(\".maximize-toggle i\")\n        .removeClass(\"fa-compress-arrows-alt\")\n        .addClass(\"fa-expand-arrows-alt\");\n      $(document.body).removeClass(\"one-journal-sub-mode\");\n    } else {\n      this.element.addClass(\"maximized\");\n      this.element\n        .find(\".maximize-toggle\")\n        .contents()\n        .last()[0].textContent = i18n(\"ApplicationRestore\");\n      this.element\n        .find(\".maximize-toggle i\")\n        .removeClass(\"fa-expand-arrows-alt\")\n        .addClass(\"fa-compress-arrows-alt\");\n    }\n  }\n\n  toggleSubMode() {\n    $(document.body).toggleClass(\"one-journal-sub-mode\");\n  }\n\n  restoreMaximized() {\n    if (this.element.hasClass(\"maximized\")) {\n      this.fullScreen();\n    }\n  }\n\n  _getHeaderButtons() {\n    let buttons = super._getHeaderButtons();\n    buttons.unshift({\n      label: i18n(\"ApplicationMaximize\"),\n      class: \"maximize-toggle\",\n      icon: \"fas fa-expand-arrows-alt\",\n      onclick: async ev => {\n        this.fullScreen();\n      },\n    });\n    return buttons;\n  }\n\n  pushWindowHistory(item: IHistoryItem) {\n    if (getSetting(settings.USE_BROWSER_HISTORY) !== true) return;\n    window.location.hash = item.hash;\n  }\n\n  // History\n  navigated(app: BaseEntitySheet) {\n    const navigatedTo = app.entity.uuid;\n    if (this.history.length !== 0) {\n      if (this.history[this.history.length - 1].id === navigatedTo) {\n        // Already last in history\n        return;\n      } else {\n        // Reset forward stack\n        this.historyFwd.length = 0;\n      }\n    }\n    if (\n      getSetting(settings.NO_DUPLICATE_HISTORY) !== true &&\n      getSetting(settings.USE_BROWSER_HISTORY) !== true\n    ) {\n      this.history = this.history.filter(h => h.id !== navigatedTo);\n    }\n\n    this.history.push({\n      id: navigatedTo,\n      title: app.title,\n      hash: `#OJ${this.historySeq++}`,\n    });\n    this.pushWindowHistory(this.history[this.history.length - 1]);\n    this.updatedHistory();\n  }\n\n  async backward() {\n    if (getSetting(settings.USE_BROWSER_HISTORY) === true) {\n      if (this.history.length > 1) window.history.back();\n      return;\n    }\n\n    if (this.history.length <= 1) {\n      this.updatedHistory();\n      return;\n    }\n    if (this.attachedId !== -1) {\n      this.historyFwd.push(this.history.pop());\n    }\n    const entity = await fromUuid(this.history[this.history.length - 1].id);\n    if (entity === null) {\n      // Remove and retry\n      this.history.pop();\n      await this.backward();\n    } else {\n      entity.sheet.render(true);\n      this.updatedHistory();\n    }\n  }\n\n  async forward() {\n    if (getSetting(settings.USE_BROWSER_HISTORY) === true) {\n      if (this.historyFwd.length != 0) window.history.forward();\n      return;\n    }\n\n    if (this.historyFwd.length == 0) {\n      this.updatedHistory();\n      return;\n    }\n    this.history.push(this.historyFwd.pop());\n    const entity = await fromUuid(this.history[this.history.length - 1].id);\n    if (entity === null) {\n      // Remove and retry\n      this.history.pop();\n      this.forward();\n    } else {\n      entity.sheet.render(true);\n      this.updatedHistory();\n    }\n  }\n\n  async goToHistoryByIndex(index: number) {\n    const entity = await fromUuid(this.history[index].id);\n\n    while (this.history.length > index + 1) {\n      this.historyFwd.push(this.history.pop());\n    }\n    entity.sheet.render(true);\n    this.updatedHistory();\n  }\n\n  async goToHistoryFwdByIndex(index: number) {\n    const entity = await fromUuid(this.historyFwd[index].id);\n\n    while (this.historyFwd.length > index) {\n      this.history.push(this.historyFwd.pop());\n    }\n    entity.sheet.render(true);\n    this.updatedHistory();\n  }\n\n  clearHistory() {\n    this.history.length = 0;\n    this.historyFwd.length = 0;\n    this.updatedHistory();\n  }\n\n  updatedHistory() {\n    const historyItems = this.history.map((item, idx) => {\n      return {\n        name: item.title,\n        icon: `<i class=\"fas fa-arrow-left\"></i>`,\n        callback: () => {\n          if (getSetting(settings.USE_BROWSER_HISTORY) === true) {\n            for (let i = 0; i < this.history.length - 1 - idx; i++) {\n              window.history.back();\n            }\n            return;\n          }\n          this.goToHistoryByIndex(idx);\n        },\n      };\n    });\n\n    const historyFwdItems = this.historyFwd.map((item, idx) => {\n      return {\n        name: item.title,\n        icon: `<i class=\"fas fa-arrow-right\"></i>`,\n        callback: () => {\n          if (getSetting(settings.USE_BROWSER_HISTORY) === true) {\n            for (let i = 0; i < this.historyFwd.length - idx; i++) {\n              window.history.forward();\n            }\n            return;\n          }\n          this.goToHistoryFwdByIndex(idx);\n        },\n      };\n    });\n\n    if (historyItems.length > 0) {\n      historyItems[\n        historyItems.length - 1\n      ].icon = `<i class=\"fas fa-circle\"></i>`;\n    }\n\n    this.contextMenu.menuItems = [\n      ...historyItems,\n      ...historyFwdItems.reverse(),\n    ].reverse();\n\n    if (getSetting(settings.USE_BROWSER_HISTORY) !== true) {\n      this.contextMenu.menuItems.unshift({\n        name: i18n(\"HistoryClearHistory\"),\n        icon: '<i class=\"fas fa-trash\"></i>',\n        callback: li => {\n          this.clearHistory();\n        },\n      });\n    } else {\n      this.contextMenu.menuItems.unshift({\n        name: i18n(\"HistoryUsingBrowserHistory\"),\n        icon: \"\",\n        callback: li => {},\n      });\n    }\n\n    if (this.history.length > 1) {\n      this.element.find(\".history-navigation .backward\").addClass(\"active\");\n    } else {\n      this.element.find(\".history-navigation .backward\").removeClass(\"active\");\n    }\n    if (this.historyFwd.length !== 0) {\n      this.element.find(\".history-navigation .forward\").addClass(\"active\");\n    } else {\n      this.element.find(\".history-navigation .forward\").removeClass(\"active\");\n    }\n  }\n\n  changeSidebarMode(mode: string) {\n    if (mode === \"left\") {\n      this.element.addClass(\"sidebar-mode-left\");\n    } else {\n      this.element.removeClass(\"sidebar-mode-left\");\n    }\n  }\n\n  setSidebarWidth(width: number) {\n    document.documentElement.style.setProperty(\n      \"--ojSidebarWidth\",\n      `${width}px`\n    );\n  }\n\n  _historyContextMenu(html) {\n    this.contextMenu = new ContextMenu(html, \".history-navigation\", [\n      {\n        name: i18n(\"HistoryClearHistory\"),\n        icon: '<i class=\"fas fa-trash\"></i>',\n        callback: li => {\n          this.clearHistory();\n        },\n      },\n    ]);\n  }\n}\n\n// @ts-ignore\nclass OneJournalDirectory extends JournalDirectory {\n  get element(): JQuery<HTMLElement> {\n    return super.element as JQuery<HTMLElement>;\n  }\n  shell: JournalShell;\n  constructor(shell, options?) {\n    super(options);\n    this.shell = shell;\n    // Record the directory as an application of the collection\n    OneJournalDirectory.collection.apps.push(this);\n  }\n  static get defaultOptions() {\n    const options = super.defaultOptions;\n    options.id = \"OneJournalDirectory\";\n    options.template = \"templates/sidebar/journal-directory.html\";\n    options.popOut = true;\n    return options;\n  }\n\n  static get entity() {\n    return \"JournalEntry\";\n  }\n\n  static get collection() {\n    return game.journal;\n  }\n\n  render(force?: boolean, options?: any): SidebarDirectory {\n    if (this.shell._state <= 0) {\n      return;\n    }\n    return super.render(force, options);\n  }\n\n  close(force?: boolean): Promise<any> {\n    if (force) {\n      return Application.prototype.close.call(this);\n    }\n    // Close the entire shell if someone tries to close directory\n    return this.shell.close();\n  }\n\n  selected(uuid: string) {\n    const [_, id] = uuid.split(\".\");\n    this.element.find(\"li.selected\").removeClass(\"selected\");\n    const selected = this.element.find(`li[data-entity-id=\"${id}\"]`);\n    selected.addClass(\"selected\");\n    if (getSetting(settings.SYNC_SIDEBAR) === false) {\n      return;\n    }\n    this.expandFolderTree(selected);\n    scrollElementIntoView(selected, this.element.find(\".directory-list\"));\n  }\n\n  deselected() {\n    this.element.find(\"li.selected\").removeClass(\"selected\");\n  }\n\n  expandFolderTree(target: JQuery<HTMLElement>) {\n    target.parents(\".folder\").removeClass(\"collapsed\");\n  }\n\n  expand(id: string, expanded: boolean) {\n    const li = this.element.find(`li[data-folder-id=\"${id}\"]`);\n    if (expanded) {\n      li.removeClass(\"collapsed\");\n    } else {\n      li.addClass(\"collapsed\");\n      li.find(\".folder\").addClass(\"collapsed\");\n    }\n    const expandedFolders = this.element.find(\n      \".directory-list > .folder:not(.collapsed)\"\n    );\n    if (expandedFolders.length === 0) {\n      this.element.removeClass(\"has-expanded-journals\");\n    } else {\n      this.element.addClass(\"has-expanded-journals\");\n    }\n  }\n\n  activateListeners(html: JQuery): void {\n    super.activateListeners(html);\n    this.shell.element.find(\".shell-sidebar\").append(this.element);\n    if (this.shell.attachedId !== -1 && this.shell.attachedUid) {\n      this.selected(this.shell.attachedUid);\n    }\n    let toggleSibling = this.element.find(\".header-actions .create-folder\");\n    if (toggleSibling.length === 0) {\n      toggleSibling = this.element.find(\".header-search .collapse-all\");\n    }\n    toggleSibling.after(\n      `<div class=\"sidebar-toggle\" title=\"${i18n(\n        \"SidebarCollapse\"\n      )}\"><i class=\"far fa-window-maximize\"></i></div>`\n    );\n\n    this.element.find(\".sidebar-toggle\").click(() => {\n      this.shell.toggleSidebar();\n    });\n    if (getSetting(settings.SIDEBAR_FOLDER_COLOR) === true) {\n      this.element.find(\"header.folder-header\").each((i, el) => {\n        if (el.style.backgroundColor) {\n          (el.nextElementSibling as HTMLElement).style.borderColor =\n            el.style.backgroundColor;\n        }\n      });\n    }\n\n    this.setSidebarCompact(getSetting(settings.SIDEBAR_COMPACT));\n\n    this.element.find(\".entity-name .fa-external-link-alt\").remove();\n    this.shell.detachedJournals.forEach(uuid => {\n      const [_, id] = uuid.split(\".\");\n      this.element\n        .find(`[data-entity-id=\"${id}\"]`)\n        .addClass(\"journal-detached\")\n        .find(`h4`)\n        .attr(\"title\", i18n(\"JournalEntryDetached\"))\n        .append(`<i class=\"fas fa-external-link-alt\"></i>`);\n    });\n  }\n\n  setSidebarCompact(on: boolean) {\n    if (on) {\n      this.element.addClass(\"compact\");\n    } else {\n      this.element.removeClass(\"compact\");\n    }\n  }\n\n  _getEntryContextOptions() {\n    // @ts-ignore\n    const options = super._getEntryContextOptions();\n    return options.concat([\n      {\n        name: \"SIDEBAR.JumpPin\",\n        icon: '<i class=\"fas fa-crosshairs\"></i>',\n        condition: li => {\n          const entry = game.journal.get(li.data(\"entity-id\"));\n          return !!entry.sceneNote;\n        },\n        callback: li => {\n          const entry = game.journal.get(li.data(\"entity-id\"));\n          entry.panToNote();\n        },\n      },\n      {\n        name: \"ONEJOURNAL.OptionOpenDetached\",\n        icon: `<i class=\"fas fa-external-link-alt\"></i>`,\n        callback: li => {\n          const entry = game.journal.get(li.data(\"entity-id\"));\n          this.shell.openDetached(entry.uuid);\n        },\n      },\n    ]);\n  }\n}\n","import { JournalShell } from \"./module/journalShell.js\";\r\nimport { getSetting, settings, registerSettings } from \"./module/settings.js\";\r\nimport { i18n } from \"./module/util.js\";\r\n\r\nclass OneJournal {\r\n  shell: JournalShell;\r\n  openButton: JQuery<HTMLElement>;\r\n\r\n  expandedChangeHandler: ProxyHandler<Object> = {\r\n    set: (target, property: string, value, receiver) => {\r\n      target[property] = value;\r\n      this.shell.directory.expand(property, value);\r\n      return true;\r\n    },\r\n    deleteProperty: (target, property) => {\r\n      const res = delete target[property];\r\n      return res;\r\n    },\r\n  };\r\n\r\n  // Listen to changes of mode swapping to support detached windows\r\n  hookSwapMode() {\r\n    //@ts-ignore\r\n    const oldOnSwapMode = JournalSheet.prototype._onSwapMode;\r\n    //@ts-ignore\r\n    JournalSheet.prototype._onSwapMode = function (event, mode) {\r\n      if (mode == \"image\" && this._sheetMode === \"text\") {\r\n        window.oneJournal?.shell.swappingJournals.add(this.entity.uuid);\r\n      } else if (mode == \"text\" && this._sheetMode === \"image\") {\r\n        window.oneJournal?.shell.swappingJournals.add(this.entity.uuid);\r\n      }\r\n\r\n      return oldOnSwapMode.call(this, event, mode);\r\n    };\r\n  }\r\n\r\n  onRenderJournalShell(app: JournalSheet, html: JQuery<HTMLElement>): void {\r\n    this._onJournalAdded(app);\r\n\r\n    if (getSetting(settings.DBL_CLICK_EDIT) === true) {\r\n      html.find(\".editor\").dblclick(evt => {\r\n        if (evt.target.closest(\".editor-content\")) {\r\n          $(app.element).find(\".editor-edit\").click();\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  init() {\r\n    this.shell = new JournalShell();\r\n    this.hookSwapMode();\r\n\r\n    Hooks.on(\"closeJournalSheet\", (app: JournalSheet, html, data) => {\r\n      this._onJournalRemoved(app);\r\n    });\r\n  }\r\n\r\n  _onJournalAdded(sheet: JournalSheet) {\r\n    if (getSetting(settings.USE_ONE_JOURNAL) === false) {\r\n      return;\r\n    }\r\n    this.shell.open(sheet);\r\n  }\r\n\r\n  _onJournalRemoved(app: JournalSheet) {\r\n    this.shell.detach(app);\r\n  }\r\n\r\n  toggleOpenButton(show: boolean) {\r\n    if (show) {\r\n      window.oneJournal.openButton.css(\"display\", \"block\");\r\n    } else {\r\n      window.oneJournal.openButton.css(\"display\", \"none\");\r\n    }\r\n  }\r\n  userPermitted(): boolean {\r\n    return !(getSetting(settings.GM_ONLY) === true && !game.user.isGM);\r\n  }\r\n}\r\n\r\nHooks.on(\r\n  \"renderJournalSheet\",\r\n  (app: JournalSheet, html: JQuery<HTMLElement>) => {\r\n\r\n    if (!app.popOut) {\r\n      // GM Screen Renders journalSheets without popOut\r\n      return;\r\n    }\r\n\r\n    window.oneJournal?.onRenderJournalShell(app, html);\r\n  }\r\n);\r\n\r\nHooks.once(\"init\", async function () {\r\n  registerSettings({\r\n    [settings.SIDEBAR_MODE]: val => {\r\n      window.oneJournal.shell.changeSidebarMode(val);\r\n    },\r\n    [settings.OPEN_BUTTON_IN_DIRECTORY]: val => {\r\n      window.oneJournal.toggleOpenButton(val);\r\n    },\r\n    [settings.SIDEBAR_WIDTH]: val => {\r\n      window.oneJournal?.shell?.setSidebarWidth(val);\r\n    },\r\n    [settings.SIDEBAR_COMPACT]: val => {\r\n      window.oneJournal?.shell?.directory?.setSidebarCompact(val);\r\n    },\r\n    [settings.FOLDER_SELECTOR]: val => {\r\n      if (val) {\r\n        window.oneJournal?.shell?.element?.addClass(\"show-folder-select\");\r\n      } else {\r\n        window.oneJournal?.shell?.element?.removeClass(\"show-folder-select\");\r\n      }\r\n    },\r\n  });\r\n\r\n  CONFIG.TinyMCE.css?.push(\"/modules/one-journal/editor.css\");\r\n  CONFIG.TinyMCE.content_css?.push(\"/modules/one-journal/editor.css\");\r\n\r\n  window.oneJournal = window.oneJournal || new OneJournal();\r\n  // Button in sidebar directory\r\n  Hooks.on(\r\n    \"renderJournalDirectory\",\r\n    (app: JournalSheet, html: JQuery<HTMLElement>, data) => {\r\n      if (\r\n        !window.oneJournal.userPermitted() ||\r\n        html.closest(\"#OneJournalDirectory\").length != 0\r\n      ) {\r\n        return;\r\n      }\r\n\r\n      window.oneJournal.openButton = $(\r\n        `<button class=\"one-journal-open\">${i18n(\"OpenButton\")}</button>`\r\n      );\r\n      window.oneJournal.openButton.click(() => {\r\n        window.oneJournal.shell.render(true);\r\n      });\r\n      html.find(\".directory-footer\").append(window.oneJournal.openButton);\r\n\r\n      window.oneJournal.toggleOpenButton(\r\n        getSetting(settings.OPEN_BUTTON_IN_DIRECTORY)\r\n      );\r\n    }\r\n  );\r\n\r\n  // Patch links for opening detached\r\n  {\r\n    // Entity links in enriched html\r\n    //@ts-ignore\r\n    const oldOnClickEntityLink = TextEditor._onClickEntityLink;\r\n    async function onClickEntityLink(event: MouseEvent) {\r\n      const a = event.currentTarget as HTMLElement;\r\n\r\n      if (!event.shiftKey) {\r\n        oldOnClickEntityLink(event);\r\n        return;\r\n      }\r\n\r\n      let uuid = \"\";\r\n      if (\r\n        a.dataset.pack &&\r\n        game.packs.get(a.dataset.pack)?.entity === \"JournalEntry\"\r\n      ) {\r\n        uuid = `Compendium.${a.dataset.pack}.${a.dataset.id}`;\r\n      } else if (a.dataset.entity === \"JournalEntry\") {\r\n        uuid = `${a.dataset.entity}.${a.dataset.id}`;\r\n      } else {\r\n        oldOnClickEntityLink(event);\r\n        return;\r\n      }\r\n      event.preventDefault();\r\n      window.oneJournal.shell.openDetached(uuid);\r\n    }\r\n    //@ts-ignore\r\n    TextEditor._onClickEntityLink = onClickEntityLink;\r\n\r\n    // Journal sidebar link handler\r\n    //@ts-ignore\r\n    const oldOnClickEntityName = JournalDirectory._onClickEntityName;\r\n    function onClickEntityName(event) {\r\n      event.preventDefault();\r\n      const element = event.currentTarget;\r\n      const entityId = element.parentElement.dataset.entityId;\r\n      const entity = game.journal.get(entityId);\r\n      if (event.shiftKey) {\r\n        window.oneJournal.shell.openDetached(entity.uuid);\r\n        return;\r\n      }\r\n      const sheet = entity.sheet;\r\n      // @ts-ignore\r\n      if (sheet._minimized) return sheet.maximize();\r\n      else return sheet.render(true);\r\n    }\r\n    //@ts-ignore\r\n    JournalDirectory.prototype._onClickEntityName = onClickEntityName;\r\n  }\r\n});\r\n\r\nHooks.once(\"ready\", function () {\r\n  console.log(\"One Journal | Initializing One Journal\");\r\n  if (!window.oneJournal.userPermitted()) {\r\n    window.oneJournal.openButton?.css(\"display\", \"none\");\r\n    console.log(\"One Journal | disabled for user\");\r\n    return;\r\n  }\r\n  window.oneJournal.init();\r\n  if (game.modules.get(\"popout\")) {\r\n    popOutHacks();\r\n  }\r\n});\r\n\r\n// Hacks for popout module\r\nfunction popOutHacks() {\r\n  // Opening journals from inside the popout should not act as a dialog\r\n  Object.defineProperty(JournalSheet.prototype, \"options\", {\r\n    get: function () {\r\n      if (!this.entity) {\r\n        return this._options;\r\n      }\r\n      const detaching = window.oneJournal?.shell.detachedJournals.has(\r\n        this.entity.uuid\r\n      );\r\n      return {\r\n        ...this._options,\r\n        popOutModuleDisable: !detaching,\r\n      };\r\n    },\r\n    set: function (value) {\r\n      this._options = value;\r\n    },\r\n  });\r\n}\r\n"],"names":[],"mappings":"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"}