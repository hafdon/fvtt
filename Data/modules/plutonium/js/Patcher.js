const _0x143e=['sheetClass','each','test','findIndex','length','header.message-header','sheetMode','template','actor','</div>\x0a\x09\x09\x09\x09','_CACHED_CLASS','init','bringToFront','17cmQicI','\x20Journal\x20Entry\x20(SHIFT\x20for\x20All\x20Entries)\x22\x20onclick=\x22window.PlutPatcher.TextEditor.handleToggleClick(event)\x22\x20type=\x22button\x22>','JournalSheet','getElementsByTagName','constructor','max','\x20Journal\x20Entry\x20(SHIFT\x20for\x20All\x20Entries)','name','sheet','_onUpdate','Token','info','.message','mouseover.','<button\x20class=\x22btn\x20btn-xxs\x20btn-5et\x20btn-default\x20flex-vh-center\x20mx-1\x20jemb__btn-toggle\x22\x20data-plut-is-expanded=\x22','isEnableContentEmbeds','options','messageId','_getEntityPermissions','user','_id','style','_HAS_PATCHED','position','alias','removeChild','canvasReady','\x22\x20title=\x22','title','whisper','59333SlDlYq','</a>','_getMessageMeta','FLAG_IFRAME_URL','get','bind','floor','PlutPatcher','JournalEntry','doRemovePatch','\x22\x20was\x20not\x20valid!','next','_LAST_CONFIG_STATE','_onUpdateTokenActor','MODULE_NAME','startsWith','fill','forEach','<i\x20class=\x22fa\x20fa-caret-square-down\x22></i>','cacheMethod','addChild','plutonium.configUpdate','disabled','chatmsg__trim-top--inspecting','MODULE_LOCATION','set','_onUpdateBaseActor','BUTTON','_doPatchActorContextMenuOptions','restoreCachedMethod','dragResistance','.message[data-message-id=\x22','</div>\x0a\x09\x09\x09</div>','min','fontSize','isCompactChat','push','placeables','contains','_LAST_MESSAGE_META','text','entities','_getBtnHtmlToggle','_handleExpandCollapse','button[data-plut-is-expanded]','Text','shiftKey','notifications','anchor','984721xMwdku','isEnableUrlEmbeds','_disableFields','_doBindTrimmedTopEventHandlers','Util','blind','_handleDeleteChatMessage','maximize','\x0a\x09\x09\x09\x09<div\x20class=\x22w-100\x20jemb__wrp-content\x20','1pUDPyq','windows','_handleRenderChatMessage','owner','chatmsg__trim-top','12pvHWxT','mousemove.','ChatMessage','_isMetaMatch','targetActorId','isAutoExpandContentEmbeds','attr','Set\x20as\x20Rivet\x20Target','data','</button>','mouseleave.','ve-hidden','html','tokens','actors','timestamp','291004PtuSUR','replace','content','OBSERVER','collection','OWNER','28915UqlVgy','closest','image','remove','\x22><a\x20target=\x22_blank\x20w-100\x22\x20href=\x22','journalEntries','deleteChatMessage','Drawing','Set\x20Embed\x20URL','PERMISSION.Configure','$ele','TextEditor','setFlag','render','defaultOptions','journal','ENTITY_PERMISSIONS','\x22\x20class=\x22jemb__img\x22></a></div>\x0a\x09\x09\x09</div>','73AOBBuv','element','default','data-plut-is-expanded','off','-chat','chatmsg__trim-bottom','addClass','find','_doEnableToggleButtons','_SPEAKER_TIMEOUT_MSEC','splice','src','_EVENT_NAMESPACE','doApplyPatch','pGetUserString','apps','isFixDrawingFreehandMinDistance','removeClass','URL/iframe\x20\x22','isDisplayDamageDealt','938866dXnNnN','_DID_PATCH','preventDefault','_getEntityEmbed','_getEntity','_LAST_IS_ENABLED','handleConfigUpdate','_plutonium_xDispDamageDealt','_CACHED_MOUSE_INTERACTION_MANAGER_OPTIONS','.editor','refresh','_sheetMode','_handleConfigUpdate','_replaceEntityLink','3062gpplUc','Enter\x20iframe\x20or\x20URL','entityId','prototype','object','Failed\x20to\x20refresh\x20token\x20\x22','close','<i\x20class=\x22fas\x20fa-link\x22></i>','_$getExistingRender','Rivet\x20content\x20will\x20now\x20be\x20imported\x20to\x20Actor\x20\x22','1519232wVxKeo','Expand','showVe','removeAttribute','chat','dataset','forceClose','permission','_doRemoveFromExistingMessages','values','warn','handleToggleClick','<a\x20class=\x22entity-link\x20broken\x22><i\x20class=\x22fas\x20fa-unlink\x22></i>\x20','author','<div\x20class=\x22w-100\x20flex-col\x22>\x0a\x09\x09\x09\x09<div\x20class=\x22flex-v-center\x20mb-1\x20jemb__wrp-lnk\x22>','_handleConfigUpdate_displayDamageDealt_doRefreshTokens','_doHandleExistingMessage','rivet','mouseInteractionManager','hasClass','parent','_handleConfigUpdate_displayDamageDealt_doUpdateDisplay','_doPatchJournalContextMenuOptions','getFlag','_handleConfigUpdate_displayDamageDealt','/mod-template/journal/sheet.handlebars','_getEntryContextOptions','color','attributes','classList','enrichHTML','<i\x20class=\x22fa\x20fa-caret-square-left\x22></i>','_handleConfigUpdate_displayDamageDealt_doAddDisplay'];const _0x530f=function(_0x497fa1,_0x24e80a){_0x497fa1=_0x497fa1-0xa6;let _0x143eb1=_0x143e[_0x497fa1];return _0x143eb1;};const _0x119f20=_0x530f;(function(_0x49b53e,_0x1b3126){const _0x469405=_0x530f;while(!![]){try{const _0x37ddd3=parseInt(_0x469405(0x164))+-parseInt(_0x469405(0x122))*-parseInt(_0x469405(0x119))+-parseInt(_0x469405(0x127))*-parseInt(_0x469405(0xe8))+parseInt(_0x469405(0x14f))*parseInt(_0x469405(0x172))+parseInt(_0x469405(0x13d))*-parseInt(_0x469405(0xca))+-parseInt(_0x469405(0x137))+-parseInt(_0x469405(0x17c));if(_0x37ddd3===_0x1b3126)break;else _0x49b53e['push'](_0x49b53e['shift']());}catch(_0xb6952e){_0x49b53e['push'](_0x49b53e['shift']());}}}(_0x143e,0x88106));import{SharedConsts}from'../shared/SharedConsts.js';import{Consts}from'./Consts.js';import{UtilApplications}from'./UtilApplications.js';import{Config}from'./Config.js';import{UtilPatch}from'./UtilPatch.js';import{LGT}from'./Util.js';class Patcher{static[_0x119f20(0xc8)](){const _0x56156c=_0x119f20;this[_0x56156c(0x104)](),this[_0x56156c(0xb2)](),Patcher['ChatMessage'][_0x56156c(0xc8)](),Hooks['on'](_0x56156c(0xfd),()=>this[_0x56156c(0x170)]()),this[_0x56156c(0x170)](),Hooks['on'](_0x56156c(0xe4),()=>{const _0x4dd192=_0x56156c;Patcher[_0x4dd192(0x144)][_0x4dd192(0x16a)]();});}static[_0x119f20(0x170)](){const _0x442b1a=_0x119f20;Patcher[_0x442b1a(0xd4)]['handleConfigUpdate'](),Patcher[_0x442b1a(0x144)][_0x442b1a(0x16a)](),Patcher[_0x442b1a(0x148)]['handleConfigUpdate'](),Patcher[_0x442b1a(0x129)][_0x442b1a(0x16a)](),JournalSheet_Plutonium['handleConfigUpdate']();}static[_0x119f20(0x104)](){const _0x980b1a=_0x119f20,_0x532125=ui[_0x980b1a(0x135)][_0x980b1a(0xb6)][_0x980b1a(0xed)](ui[_0x980b1a(0x135)]);ui[_0x980b1a(0x135)][_0x980b1a(0xb6)]=()=>{const _0x492c32=_0x980b1a,_0x383b41=_0x532125();return _0x383b41[_0x492c32(0x10c)]({'name':_0x492c32(0x12e),'icon':'<i\x20class=\x22fas\x20fa-hammer\x22></i>','condition':_0x5360f7=>{const _0x17d22a=_0x492c32,_0x38ecca=ActorDirectory['collection'][_0x17d22a(0xec)](_0x5360f7[_0x17d22a(0x12f)]('entityId'));return _0x38ecca[_0x17d22a(0x125)];},'callback':_0x8c565e=>{const _0x571f42=_0x492c32,_0x3bcfbc=ActorDirectory[_0x571f42(0x13b)]['get'](_0x8c565e[_0x571f42(0x12f)](_0x571f42(0x174)));Config[_0x571f42(0x101)](_0x571f42(0xad),_0x571f42(0x12b),_0x3bcfbc['id']),ui['notifications'][_0x571f42(0xd5)](_0x571f42(0x17b)+_0x3bcfbc['id']+'\x22.\x20This\x20can\x20be\x20changed\x20in\x20the\x20Config.');}}),_0x383b41;};}static[_0x119f20(0xb2)](){const _0x37786b=_0x119f20,_0x38d199=ui['journal']['_getEntryContextOptions'][_0x37786b(0xed)](ui['journal']);ui[_0x37786b(0x14c)][_0x37786b(0xb6)]=()=>{const _0xed0a2=_0x37786b,_0x42800b=_0x38d199(),_0x2a3f02=_0x42800b[_0xed0a2(0xc0)](_0x52f34d=>_0x52f34d['name']===_0xed0a2(0x146));if(!~_0x2a3f02)return _0x42800b;return _0x42800b[_0xed0a2(0x15a)](_0x2a3f02+0x1,0x0,{'name':_0xed0a2(0x145),'icon':_0xed0a2(0x179),'condition':_0x3bb25b=>{const _0x21a833=_0xed0a2;if(!Config[_0x21a833(0xec)](_0x21a833(0x142),_0x21a833(0x11a)))return![];const _0x1acdab=JournalDirectory[_0x21a833(0x13b)][_0x21a833(0xec)](_0x3bb25b[_0x21a833(0x12f)]('entityId'));return _0x1acdab['owner'];},'callback':async _0x5e584f=>{const _0x454edb=_0xed0a2,_0x4ed122=JournalDirectory[_0x454edb(0x13b)][_0x454edb(0xec)](_0x5e584f[_0x454edb(0x12f)](_0x454edb(0x174))),_0x40b24a=await _0x4ed122['getFlag'](SharedConsts[_0x454edb(0xf6)],Consts[_0x454edb(0xeb)]);let _0x2d470f=await InputUiUtil[_0x454edb(0x15e)]({'title':_0x454edb(0x173),'default':_0x40b24a||''});if(_0x2d470f==null)return;Object['values'](_0x4ed122[_0x454edb(0x15f)])[_0x454edb(0xf9)](_0x4eed7e=>{const _0x38b24b=_0x454edb;_0x4eed7e['forceClose']?_0x4eed7e['forceClose']():_0x4eed7e[_0x38b24b(0x178)]();});if(!_0x2d470f)await _0x4ed122[_0x454edb(0x149)](SharedConsts[_0x454edb(0xf6)],Consts[_0x454edb(0xeb)],'');else{_0x2d470f=_0x2d470f['trim']();if(_0x2d470f[_0x454edb(0xf7)]('<iframe'))_0x2d470f=$(_0x2d470f)['attr'](_0x454edb(0x15b));!_0x2d470f&&(ui[_0x454edb(0x117)][_0x454edb(0xa6)](_0x454edb(0x162)+_0x2d470f+_0x454edb(0xf2)),await _0x4ed122[_0x454edb(0x149)](SharedConsts[_0x454edb(0xf6)],Consts[_0x454edb(0xeb)],'')),await _0x4ed122[_0x454edb(0x149)](SharedConsts[_0x454edb(0xf6)],Consts[_0x454edb(0xeb)],_0x2d470f);}}}),_0x42800b;};}}Patcher[_0x119f20(0xd4)]=class{static[_0x119f20(0x16a)](){const _0x33816b=_0x119f20;this[_0x33816b(0xb4)]();}static[_0x119f20(0xb4)](){const _0x118c8c=_0x119f20,_0x54011f=UtilPatch[_0x118c8c(0xfb)](Token[_0x118c8c(0x175)],_0x118c8c(0x16e)),_0x1177a9=UtilPatch['cacheMethod'](Token[_0x118c8c(0x175)],'_onUpdate'),_0x26da03=UtilPatch['cacheMethod'](Token[_0x118c8c(0x175)],_0x118c8c(0xf5)),_0x5cf9b5=UtilPatch[_0x118c8c(0xfb)](Token[_0x118c8c(0x175)],'_onUpdateBaseActor');if(!Config[_0x118c8c(0xec)](_0x118c8c(0x134),_0x118c8c(0x163))){UtilPatch[_0x118c8c(0x105)](Token['prototype'],_0x118c8c(0x16e)),UtilPatch[_0x118c8c(0x105)](Token[_0x118c8c(0x175)],'_onUpdate'),UtilPatch['restoreCachedMethod'](Token['prototype'],_0x118c8c(0xf5)),UtilPatch[_0x118c8c(0x105)](Token['prototype'],_0x118c8c(0x102)),this[_0x118c8c(0xab)]({'isRemoveDisplays':!![]});return;}Token[_0x118c8c(0x175)][_0x118c8c(0x16e)]=function(..._0x464e66){const _0x52edc7=_0x118c8c;Patcher[_0x52edc7(0xd4)][_0x52edc7(0xb1)](this),_0x54011f[_0x52edc7(0xed)](this)(..._0x464e66);},Token['prototype'][_0x118c8c(0xd3)]=function(..._0x4675e9){const _0x264318=_0x118c8c;Patcher[_0x264318(0xd4)][_0x264318(0xb1)](this),_0x1177a9[_0x264318(0xed)](this)(..._0x4675e9);},Token[_0x118c8c(0x175)][_0x118c8c(0xf5)]=function(..._0x3da7bc){const _0x3b3460=_0x118c8c;Patcher[_0x3b3460(0xd4)][_0x3b3460(0xb1)](this),_0x26da03[_0x3b3460(0xed)](this)(..._0x3da7bc);},Token['prototype'][_0x118c8c(0x102)]=function(..._0xee9256){const _0x46f6aa=_0x118c8c;Patcher[_0x46f6aa(0xd4)][_0x46f6aa(0xb1)](this),_0x5cf9b5[_0x46f6aa(0xed)](this)(..._0xee9256);},this[_0x118c8c(0xab)]();}static['_handleConfigUpdate_displayDamageDealt_doRefreshTokens'](_0x4bbd95){const _0x27681d=_0x119f20;_0x4bbd95=_0x4bbd95||{};const _0x47d6fc=MiscUtil['get'](canvas,_0x27681d(0x134),_0x27681d(0x10d))||[];for(const _0x18c051 of _0x47d6fc){try{_0x4bbd95['isRemoveDisplays']&&_0x18c051[_0x27681d(0x16b)]&&(_0x18c051[_0x27681d(0xe3)](_0x18c051['_plutonium_xDispDamageDealt']),_0x18c051['_plutonium_xDispDamageDealt']=null),_0x18c051[_0x27681d(0x16e)]();}catch(_0xf01206){console['warn'](...LGT,_0x27681d(0x177)+_0x18c051[_0x27681d(0xde)]+'\x22!',_0xf01206);}}}static[_0x119f20(0xb1)](_0x4eb4ff){const _0x524593=_0x119f20;this[_0x524593(0xbc)](_0x4eb4ff);const _0x342777=MiscUtil[_0x524593(0xec)](_0x4eb4ff[_0x524593(0xc5)],'data',_0x524593(0x12f),_0x524593(0xb8),'hp',_0x524593(0xcf))||0x0,_0x42cca6=MiscUtil[_0x524593(0xec)](_0x4eb4ff['actor'],_0x524593(0x12f),_0x524593(0x12f),_0x524593(0xb8),'hp','value')||0x0,_0x287cda=Math[_0x524593(0x109)](_0x342777,Math['max'](0x0,_0x342777-_0x42cca6));_0x4eb4ff[_0x524593(0x16b)][_0x524593(0x110)]=''+_0x287cda,_0x4eb4ff[_0x524593(0x16b)]['visible']=!!_0x287cda;if(_0x42cca6<=Math[_0x524593(0xee)](_0x342777/0x2))_0x4eb4ff['_plutonium_xDispDamageDealt'][_0x524593(0xdf)]['fill']=0xff0000;else _0x4eb4ff[_0x524593(0x16b)][_0x524593(0xdf)][_0x524593(0xf8)]=0xffffff;}static[_0x119f20(0xbc)](_0x3a4175){const _0x4cb5cf=_0x119f20;if(_0x3a4175[_0x4cb5cf(0x16b)]&&_0x3a4175['_plutonium_xDispDamageDealt'][_0x4cb5cf(0xb0)])return;_0x3a4175['_plutonium_xDispDamageDealt']&&!_0x3a4175[_0x4cb5cf(0x16b)][_0x4cb5cf(0xb0)]&&(_0x3a4175[_0x4cb5cf(0xe3)](_0x3a4175['_plutonium_xDispDamageDealt']),_0x3a4175[_0x4cb5cf(0x16b)]=null),_0x3a4175[_0x4cb5cf(0x16b)]=new PIXI[(_0x4cb5cf(0x115))]('',CONFIG['canvasTextStyle']['clone']()),_0x3a4175['_plutonium_xDispDamageDealt'][_0x4cb5cf(0xdf)][_0x4cb5cf(0x10a)]=0x18,_0x3a4175[_0x4cb5cf(0x16b)][_0x4cb5cf(0x118)][_0x4cb5cf(0x101)](0x1,0x1),_0x3a4175[_0x4cb5cf(0x16b)][_0x4cb5cf(0xe1)][_0x4cb5cf(0x101)](_0x3a4175['w']-0x3,_0x3a4175['h']-0x1),_0x3a4175[_0x4cb5cf(0xfc)](_0x3a4175[_0x4cb5cf(0x16b)]);}},Patcher['Drawing']=class{static[_0x119f20(0x16a)](){const _0x4142b8=_0x119f20;if(!MiscUtil['get'](canvas,_0x4142b8(0xae),_0x4142b8(0xda)))return;if(Config[_0x4142b8(0xec)]('ui',_0x4142b8(0x160))){if(Patcher[_0x4142b8(0x144)]['_CACHED_MOUSE_INTERACTION_MANAGER_OPTIONS']==null)Patcher[_0x4142b8(0x144)][_0x4142b8(0x16c)]=canvas[_0x4142b8(0xae)]['options'];canvas['mouseInteractionManager'][_0x4142b8(0xda)][_0x4142b8(0x106)]=0x1;}else{if(Patcher[_0x4142b8(0x144)][_0x4142b8(0x16c)]!=null)canvas[_0x4142b8(0xae)]['options']=Patcher[_0x4142b8(0x144)][_0x4142b8(0x16c)];}}},Patcher[_0x119f20(0x144)]['_CACHED_MOUSE_INTERACTION_MANAGER_OPTIONS']=null,Patcher[_0x119f20(0x148)]=class{static[_0x119f20(0x16a)](){const _0xdbac37=_0x119f20,_0x5c9f9f=UtilPatch[_0xdbac37(0xfb)](TextEditor,'enrichHTML',{'isBind':!![]}),_0x14352a=UtilPatch['cacheMethod'](JournalSheet[_0xdbac37(0x175)],_0xdbac37(0x11b));if(!Config['get'](_0xdbac37(0x142),_0xdbac37(0xd9))){UtilPatch[_0xdbac37(0x105)](TextEditor,_0xdbac37(0xba)),UtilPatch[_0xdbac37(0x105)](JournalSheet[_0xdbac37(0x175)],'_disableFields');return;}TextEditor['enrichHTML']=Patcher[_0xdbac37(0x148)][_0xdbac37(0xba)][_0xdbac37(0xed)](this,_0x5c9f9f),JournalSheet[_0xdbac37(0x175)][_0xdbac37(0x11b)]=function(..._0xf43bd5){const _0x1c8fa3=_0xdbac37;_0x14352a[_0x1c8fa3(0xed)](this)(..._0xf43bd5),Patcher[_0x1c8fa3(0x148)][_0x1c8fa3(0x158)](..._0xf43bd5);};}static['enrichHTML'](_0x3dd705,_0x304291,{secrets:secrets=![],entities:entities=!![],links:links=!![],rolls:rolls=!![],rollData:rollData=null}={},_0x44d056=0x0){const _0x37ea67=_0x119f20,_0x13403c={'secrets':secrets,'entities':entities,'links':links,'rolls':rolls,'rollData':rollData};_0x304291=_0x3dd705(_0x304291,_0x13403c);if(!entities)return _0x304291;return _0x304291=_0x304291[_0x37ea67(0x138)](/@Embed(JournalEntry)\[([^\]]+)](?:{([^}]+)})?/g,(..._0x438379)=>this[_0x37ea67(0x167)](_0x13403c,_0x44d056,..._0x438379)),_0x304291;}static[_0x119f20(0x167)](_0x10194a,_0xff7a10,_0x8c14b1,_0x56df6d,_0x334cba,_0x26a5fc){const _0x5a5fd0=_0x119f20,_0x17ca88=CONFIG[_0x56df6d],_0x568027=_0x17ca88['entityClass'][_0x5a5fd0(0x13b)],_0x64bf0b=this[_0x5a5fd0(0x168)](_0x568027,_0x334cba);if(!_0x64bf0b)return _0x5a5fd0(0xa8)+(_0x26a5fc||_0x334cba)+_0x5a5fd0(0xe9);if(this[_0x5a5fd0(0xdc)](_0x64bf0b)<CONST[_0x5a5fd0(0x14d)][_0x5a5fd0(0x13a)])return _0x5a5fd0(0xa8)+(_0x26a5fc||_0x334cba)+'\x20<i>(you\x20do\x20not\x20have\x20sufficient\x20permissions\x20to\x20view\x20this\x20journal\x20entry)</i></a>';const _0x4f0b30=TextEditor[_0x5a5fd0(0x171)](_0x8c14b1,_0x56df6d,_0x334cba,_0x26a5fc),_0x1ba23e=Config[_0x5a5fd0(0xec)](_0x5a5fd0(0x142),_0x5a5fd0(0x12c));if(_0x64bf0b[_0x5a5fd0(0xd2)]['_sheetMode']===_0x5a5fd0(0x13f)){const _0x95d621=_0x64bf0b[_0x5a5fd0(0x12f)]['img'];return'<div\x20class=\x22w-100\x20flex-col\x22>\x0a\x09\x09\x09\x09<div\x20class=\x22flex-v-center\x20mb-1\x20jemb__wrp-lnk\x22>'+_0x4f0b30+this[_0x5a5fd0(0x112)](_0x1ba23e)+'</div>\x0a\x09\x09\x09\x09<div\x20class=\x22flex-vh-center\x20jemb__wrp-content\x20'+(_0x1ba23e?'':'ve-hidden')+_0x5a5fd0(0x141)+_0x95d621+'\x22><img\x20src=\x22'+_0x95d621+_0x5a5fd0(0x14e);}else{const _0x2f4867=_0xff7a10===Patcher['TextEditor']['_MAX_RECURSION_DEPTH'],_0x12f82e=_0x2f4867?_0x64bf0b[_0x5a5fd0(0x12f)][_0x5a5fd0(0x139)]:TextEditor['enrichHTML'](_0x64bf0b[_0x5a5fd0(0x12f)][_0x5a5fd0(0x139)],_0x10194a,_0xff7a10+0x1);return _0x5a5fd0(0xaa)+_0x4f0b30+this[_0x5a5fd0(0x112)](_0x1ba23e)+_0x5a5fd0(0xc6)+(_0x2f4867?'<div\x20class=\x22mb-1\x20bold\x20veapp__msg-error\x22>Warning:\x20too\x20many\x20recursive\x20embeds!\x20Have\x20you\x20made\x20an\x20infinite\x20loop?</div>':'')+_0x5a5fd0(0x121)+(_0x1ba23e?'':_0x5a5fd0(0x132))+'\x22>'+_0x12f82e+_0x5a5fd0(0x108);}}static[_0x119f20(0xdc)](_0x12cca7){const _0x57dbd4=_0x119f20;if(game[_0x57dbd4(0xdd)]['isGM'])return CONST[_0x57dbd4(0x14d)][_0x57dbd4(0x13c)];return Math['max'](_0x12cca7[_0x57dbd4(0x12f)][_0x57dbd4(0x183)][game[_0x57dbd4(0xdd)][_0x57dbd4(0xde)]],_0x12cca7[_0x57dbd4(0x12f)][_0x57dbd4(0x183)][_0x57dbd4(0x151)]);}static['_getEntity'](_0x1f64f8,_0x1193a9){const _0x273eab=_0x119f20;let _0x51c58c=null;if(/^[a-zA-Z0-9]{16}$/[_0x273eab(0xbf)](_0x1193a9))_0x51c58c=_0x1f64f8[_0x273eab(0xec)](_0x1193a9);if(!_0x51c58c)_0x51c58c=_0x1f64f8[_0x273eab(0x111)][_0x273eab(0x157)](_0xe42d71=>_0xe42d71['data'][_0x273eab(0xd1)]===_0x1193a9);return _0x51c58c;}static[_0x119f20(0xa7)](_0x46e26d){const _0x43b2cb=_0x119f20,_0x4d87f1=$(_0x46e26d['currentTarget']),_0x380416=_0x4d87f1[_0x43b2cb(0x12d)]('data-plut-is-expanded')==='1';if(_0x46e26d[_0x43b2cb(0x116)]){_0x46e26d[_0x43b2cb(0x166)]();const _0x5732d3=_0x4d87f1[_0x43b2cb(0x13e)](_0x43b2cb(0x16d));_0x5732d3[_0x43b2cb(0x157)](_0x43b2cb(0x114))['each']((_0x4b71cb,_0x49123e)=>this[_0x43b2cb(0x113)]($(_0x49123e),_0x380416));return;}this[_0x43b2cb(0x113)](_0x4d87f1,_0x380416);}static['_handleExpandCollapse'](_0x366bc6,_0x465d9f){const _0x4ef1f2=_0x119f20,_0x3307f7=_0x366bc6[_0x4ef1f2(0xb0)]()[_0x4ef1f2(0xf3)]();_0x3307f7['toggleClass'](_0x4ef1f2(0x132),_0x465d9f),_0x366bc6[_0x4ef1f2(0x12d)](_0x4ef1f2(0x152),_0x465d9f?'0':'1')[_0x4ef1f2(0x133)](_0x465d9f?_0x4ef1f2(0xbb):'<i\x20class=\x22fa\x20fa-caret-square-down\x22></i>')[_0x4ef1f2(0xe6)]((_0x465d9f?_0x4ef1f2(0x17d):'Collapse')+_0x4ef1f2(0xd0));}static['_getBtnHtmlToggle'](_0x578071){const _0xcede3a=_0x119f20;return _0xcede3a(0xd8)+(_0x578071?0x1:0x0)+_0xcede3a(0xe5)+(_0x578071?'Collapse':_0xcede3a(0x17d))+_0xcede3a(0xcb)+(_0x578071?_0xcede3a(0xfa):'<i\x20class=\x22fa\x20fa-caret-square-left\x22></i>')+_0xcede3a(0x130);}static[_0x119f20(0x158)](_0x2857f8){const _0x20a28e=_0x119f20;for(let _0x1b34e2 of _0x2857f8[_0x20a28e(0xcd)](_0x20a28e(0x103))){if(_0x1b34e2[_0x20a28e(0xb9)][_0x20a28e(0x10e)]('jemb__btn-toggle'))_0x1b34e2[_0x20a28e(0x17f)](_0x20a28e(0xfe));}}},Patcher[_0x119f20(0x148)]['_MAX_RECURSION_DEPTH']=0x45,Patcher[_0x119f20(0x129)]=class{static[_0x119f20(0x16a)](){const _0x2e4ee0=_0x119f20;if(Patcher[_0x2e4ee0(0x129)]['_LAST_CONFIG_STATE']==null||Patcher['ChatMessage']['_LAST_CONFIG_STATE']!==Config[_0x2e4ee0(0xec)]('ui','isCompactChat')){Patcher[_0x2e4ee0(0x129)][_0x2e4ee0(0xf4)]=Config[_0x2e4ee0(0xec)]('ui','isCompactChat');if(Patcher[_0x2e4ee0(0x129)]['_LAST_CONFIG_STATE'])this['_doAddToExistingMessages']();else this[_0x2e4ee0(0x184)]();}}static['_doAddToExistingMessages'](){const _0x1a1574=_0x119f20,_0x178fa0=ui[_0x1a1574(0x180)][_0x1a1574(0x150)][_0x1a1574(0x157)](_0x1a1574(0xd6));_0x178fa0[_0x1a1574(0xbe)]((_0x4a21ff,_0x4b6c1c)=>{const _0xe5016=_0x1a1574,_0x4fa950=$(_0x4b6c1c),_0x10805c=ChatMessage[_0xe5016(0x13b)]['get'](_0x4b6c1c[_0xe5016(0x181)][_0xe5016(0xdb)]);this['_handleRenderChatMessage'](_0x10805c,_0x4fa950,!![]);});}static[_0x119f20(0x184)](){const _0x388107=_0x119f20,_0x1fa3f0=ui['chat']['element'][_0x388107(0x157)]('.message');_0x1fa3f0['each']((_0x58d829,_0x1909ba)=>{const _0x50da49=_0x388107;_0x1909ba[_0x50da49(0xb9)]['remove']('chatmsg__trim-top'),_0x1909ba[_0x50da49(0xb9)][_0x50da49(0x140)](_0x50da49(0x155)),$(_0x1909ba)[_0x50da49(0x153)]('mousemove.'+Patcher[_0x50da49(0x129)]['_EVENT_NAMESPACE'])[_0x50da49(0x153)](_0x50da49(0xd7)+Patcher[_0x50da49(0x129)][_0x50da49(0x15c)])[_0x50da49(0x153)](_0x50da49(0x131)+Patcher[_0x50da49(0x129)][_0x50da49(0x15c)]);});}static['init'](){const _0x119948=_0x119f20;Hooks['on']('renderChatMessage',(_0x373107,_0x17d28b)=>{const _0x2978e1=_0x530f;if(!Config[_0x2978e1(0xec)]('ui',_0x2978e1(0x10b)))return;this[_0x2978e1(0x124)](_0x373107,_0x17d28b);}),Hooks['on'](_0x119948(0x143),(..._0x8ecb3c)=>{const _0x1c60d6=_0x119948;if(!Config[_0x1c60d6(0xec)]('ui',_0x1c60d6(0x10b)))return;this[_0x1c60d6(0x11f)](..._0x8ecb3c);});}static[_0x119f20(0x124)](_0x6f712a,_0x5d5fe7,_0x560d63){const _0x44f4fa=_0x119f20;if(!_0x560d63){const _0x3efbbf=this[_0x44f4fa(0x17a)](_0x6f712a);if(_0x3efbbf&&_0x3efbbf[_0x44f4fa(0xc1)])return this['_doHandleExistingMessage'](_0x6f712a,_0x5d5fe7,_0x3efbbf);}if(!this[_0x44f4fa(0x12a)](_0x6f712a)){Patcher[_0x44f4fa(0x129)]['_LAST_MESSAGE_META']=this[_0x44f4fa(0xea)](_0x6f712a,_0x5d5fe7);return;}Patcher[_0x44f4fa(0x129)]['_LAST_MESSAGE_META'][_0x44f4fa(0x147)][_0x44f4fa(0x156)]('chatmsg__trim-bottom');const _0x5b43ca=this[_0x44f4fa(0xea)](_0x6f712a,_0x5d5fe7);_0x5b43ca[_0x44f4fa(0x147)][_0x44f4fa(0x156)](_0x44f4fa(0x126)),this[_0x44f4fa(0x11c)](_0x5b43ca[_0x44f4fa(0x147)]),Patcher['ChatMessage']['_LAST_MESSAGE_META']=_0x5b43ca;}static[_0x119f20(0xea)](_0x3e0294,_0x54056b){const _0x951ae9=_0x119f20,_0x528279=_0x54056b[_0x951ae9(0x157)](_0x951ae9(0xc2));return{'$ele':_0x54056b,'$header':_0x528279,'chatMessage':_0x3e0294};}static[_0x119f20(0x17a)](_0x345887){const _0x254de7=_0x119f20;return ui[_0x254de7(0x180)][_0x254de7(0x150)][_0x254de7(0x157)](_0x254de7(0x107)+_0x345887['id']+'\x22]');}static[_0x119f20(0xac)](_0x397737,_0x954a9,_0x4d3ac5){const _0x45e6ac=_0x119f20;if(_0x4d3ac5[_0x45e6ac(0xaf)]('chatmsg__trim-bottom'))_0x954a9[_0x45e6ac(0x156)](_0x45e6ac(0x155));_0x4d3ac5[_0x45e6ac(0xaf)](_0x45e6ac(0x126))&&(_0x954a9['addClass'](_0x45e6ac(0x126)),this['_doBindTrimmedTopEventHandlers'](_0x954a9));}static[_0x119f20(0x12a)](_0x2651ca){const _0x311168=_0x119f20;if(!Patcher[_0x311168(0x129)][_0x311168(0x10f)])return![];const {chatMessage:_0x17650d}=Patcher[_0x311168(0x129)][_0x311168(0x10f)];if(_0x17650d['data'][_0x311168(0x136)]<_0x2651ca[_0x311168(0x12f)][_0x311168(0x136)]-Patcher['ChatMessage'][_0x311168(0x159)])return![];if(_0x17650d[_0x311168(0xdd)]?.['id']!==_0x2651ca[_0x311168(0xdd)]?.['id'])return![];if(_0x17650d[_0x311168(0xdd)]?.[_0x311168(0xb7)]!==_0x2651ca[_0x311168(0xdd)]?.['color'])return![];if(_0x17650d[_0x311168(0xa9)]?.['id']!==_0x2651ca[_0x311168(0xa9)]?.['id'])return![];if(_0x17650d[_0x311168(0xe2)]!==_0x2651ca[_0x311168(0xe2)])return![];if(!CollectionUtil['deepEquals'](_0x17650d[_0x311168(0x12f)]?.[_0x311168(0xe7)],_0x2651ca[_0x311168(0x12f)]?.[_0x311168(0xe7)]))return![];if(_0x17650d[_0x311168(0x12f)]?.[_0x311168(0x11e)]!==_0x2651ca['data']?.[_0x311168(0x11e)])return![];return!![];}static[_0x119f20(0x11f)](_0x443311){const _0xfeda9e=_0x119f20,_0x5a3456=ui[_0xfeda9e(0x180)]['element']['find']('.message[data-message-id=\x22'+_0x443311['id']+'\x22]'),_0x5dc13e=_0x5a3456['prev'](),_0x2b4697=_0x5a3456[_0xfeda9e(0xf3)]();_0x2b4697[_0xfeda9e(0xc1)]&&(!_0x5a3456['hasClass'](_0xfeda9e(0x126))&&_0x5a3456[_0xfeda9e(0xaf)](_0xfeda9e(0x155))&&_0x2b4697['removeClass']('chatmsg__trim-top'));_0x5dc13e[_0xfeda9e(0xc1)]&&(_0x5a3456[_0xfeda9e(0xaf)]('chatmsg__trim-top')&&!_0x5a3456[_0xfeda9e(0xaf)](_0xfeda9e(0x155))&&_0x5dc13e[_0xfeda9e(0x161)]('chatmsg__trim-bottom'));if(Patcher['ChatMessage']['_LAST_MESSAGE_META']){const {chatMessage:_0x8334a7}=Patcher[_0xfeda9e(0x129)][_0xfeda9e(0x10f)];if(_0x8334a7===_0x443311)Patcher[_0xfeda9e(0x129)][_0xfeda9e(0x10f)]=null;}}static[_0x119f20(0x11c)](_0x35ab4e){const _0x210a40=_0x119f20;_0x35ab4e['on'](_0x210a40(0x128)+Patcher[_0x210a40(0x129)]['_EVENT_NAMESPACE'],_0x2a8022=>{const _0x55f96b=_0x210a40;if(!_0x2a8022[_0x55f96b(0x116)])return;_0x35ab4e[_0x55f96b(0x156)](_0x55f96b(0xff));})['on'](_0x210a40(0xd7)+Patcher[_0x210a40(0x129)][_0x210a40(0x15c)],_0xb7b0c3=>{const _0x188e6d=_0x210a40;if(!_0xb7b0c3['shiftKey'])return;_0x35ab4e[_0x188e6d(0x156)]('chatmsg__trim-top--inspecting');})['on'](_0x210a40(0x131)+Patcher['ChatMessage'][_0x210a40(0x15c)],()=>{const _0x1e3847=_0x210a40;_0x35ab4e[_0x1e3847(0x161)]('chatmsg__trim-top--inspecting');});}},Patcher[_0x119f20(0x129)][_0x119f20(0xf4)]=null,Patcher['ChatMessage']['_SPEAKER_TIMEOUT_MSEC']=0x7530,Patcher['ChatMessage'][_0x119f20(0x10f)]=null,Patcher[_0x119f20(0x129)][_0x119f20(0x15c)]=SharedConsts['MODULE_NAME']+_0x119f20(0x154);class JournalSheet_Plutonium extends JournalSheet{static[_0x119f20(0x16a)](){const _0x5ebf99=_0x119f20,_0x39b5ca=Config[_0x5ebf99(0xec)](_0x5ebf99(0x142),_0x5ebf99(0x11a));if(JournalSheet_Plutonium[_0x5ebf99(0x169)]===_0x39b5ca)return;JournalSheet_Plutonium['_LAST_IS_ENABLED']=_0x39b5ca;if(_0x39b5ca)JournalSheet_Plutonium[_0x5ebf99(0x15d)]();else JournalSheet_Plutonium[_0x5ebf99(0xf1)]();}static[_0x119f20(0x15d)](){const _0x1af34a=_0x119f20;JournalSheet_Plutonium[_0x1af34a(0xe0)]=!![],JournalSheet=JournalSheet_Plutonium,CONFIG[_0x1af34a(0xf0)][_0x1af34a(0xbd)]=JournalSheet_Plutonium;}static['doRemovePatch'](){const _0x174bdd=_0x119f20;if(!JournalSheet_Plutonium[_0x174bdd(0xe0)])return;JournalSheet=JournalSheet_Plutonium[_0x174bdd(0xc7)],CONFIG[_0x174bdd(0xf0)][_0x174bdd(0xbd)]=JournalSheet_Plutonium['_CACHED_CLASS'],Object[_0x174bdd(0x185)](ui[_0x174bdd(0x123)])[_0x174bdd(0xf9)](_0x15874e=>{const _0x346d34=_0x174bdd;_0x15874e[_0x346d34(0xce)]===JournalSheet_Plutonium&&_0x15874e[_0x346d34(0x176)][_0x346d34(0xb3)](SharedConsts['MODULE_NAME'],Consts['FLAG_IFRAME_URL'])&&_0x15874e[_0x346d34(0x182)]();});}static get['name'](){const _0x1f4129=_0x119f20;return _0x1f4129(0xcc);}static get[_0x119f20(0x14b)](){const _0x5d3c91=_0x119f20;return{...super[_0x5d3c91(0x14b)],'template':SharedConsts[_0x5d3c91(0x100)]+_0x5d3c91(0xb5)};}get[_0x119f20(0xc4)](){const _0x19f2a8=_0x119f20;if(this[_0x19f2a8(0x16f)]===_0x19f2a8(0x13f))return ImagePopout[_0x19f2a8(0x14b)][_0x19f2a8(0xc4)];return SharedConsts[_0x19f2a8(0x100)]+_0x19f2a8(0xb5);}[_0x119f20(0x178)](..._0xdbbce0){const _0x2eb691=_0x119f20;if(this[_0x2eb691(0x176)]&&this[_0x2eb691(0x176)][_0x2eb691(0xb3)](SharedConsts[_0x2eb691(0xf6)],Consts[_0x2eb691(0xeb)])){this[_0x2eb691(0x150)]['hideVe']();return;}return super[_0x2eb691(0x178)](..._0xdbbce0);}[_0x119f20(0x182)](){const _0x5dc8ff=_0x119f20;return super[_0x5dc8ff(0x178)]();}[_0x119f20(0x14a)](..._0x21c8bd){const _0x50bcef=_0x119f20;if(_0x21c8bd[0x1]&&_0x21c8bd[0x1][_0x50bcef(0xc3)]!==this[_0x50bcef(0x16f)])return super[_0x50bcef(0x14a)](..._0x21c8bd);if(this[_0x50bcef(0x150)]&&this['element']['length']){this[_0x50bcef(0x150)][_0x50bcef(0x17e)](),this[_0x50bcef(0x120)](),UtilApplications[_0x50bcef(0xc9)](this);return;}return super[_0x50bcef(0x14a)](..._0x21c8bd);}}JournalSheet_Plutonium[_0x119f20(0x165)]=![],JournalSheet_Plutonium[_0x119f20(0xc7)]=JournalSheet,JournalSheet_Plutonium[_0x119f20(0x169)]=null,window[_0x119f20(0xef)]=Patcher,Patcher[_0x119f20(0x11d)]=UtilPatch;export{Patcher};