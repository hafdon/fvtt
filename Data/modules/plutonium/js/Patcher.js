const _0x12ac=['_LAST_IS_ENABLED','isRemoveDisplays','actors','_DID_PATCH','sheetMode','info','_onUpdateBaseActor','tokens','_getEntryContextOptions','_onUpdate','removeChild','sheetClass','name','setFlag','src','prototype','journalEntries','doApplyPatch','value','values','style','_handleConfigUpdate_displayDamageDealt','restoreCachedMethod','object','placeables','handleConfigUpdate','MODULE_NAME','_handleConfigUpdate_displayDamageDealt_doRefreshTokens','findIndex','rivet','getFlag','init','_handleConfigUpdate_displayDamageDealt_doUpdateDisplay','apps','JournalEntry','doRemovePatch','_id','text','attr','notifications','isEnableJournalEmbeds','trim','/mod-template/journal/sheet.handlebars','set','Rivet\x20content\x20will\x20now\x20be\x20imported\x20to\x20Actor\x20\x22','push','cacheMethod','parent','<i\x20class=\x22fas\x20fa-hammer\x22></i>','windows','<i\x20class=\x22fas\x20fa-link\x22></i>','FLAG_IFRAME_URL','\x22\x20was\x20not\x20valid!','plutonium.configUpdate','<iframe','element','constructor','owner','render','image','startsWith','close','actor','_doPatchActorContextMenuOptions','pGetUserString','visible','Enter\x20iframe\x20or\x20URL','Token','collection','isDisplayDamageDealt','URL/iframe\x20\x22','defaultOptions','max','JournalSheet','canvasTextStyle','min','_handleConfigUpdate','journal','_CACHED_CLASS','entityId','_onUpdateTokenActor','template','refresh','forEach','fontSize','bringToFront','_plutonium_xDispDamageDealt','clone','MODULE_LOCATION','_HAS_PATCHED','_doPatchJournalContextMenuOptions','bind','position','warn','targetActorId','get','showVe','forceClose','_sheetMode','fill','data','_handleConfigUpdate_displayDamageDealt_doAddDisplay'];(function(_0x1f1a2a,_0x12acf5){const _0x1acada=function(_0x327eab){while(--_0x327eab){_0x1f1a2a['push'](_0x1f1a2a['shift']());}};_0x1acada(++_0x12acf5);}(_0x12ac,0xe6));const _0x1aca=function(_0x1f1a2a,_0x12acf5){_0x1f1a2a=_0x1f1a2a-0x0;let _0x1acada=_0x12ac[_0x1f1a2a];return _0x1acada;};import{SharedConsts}from'../shared/SharedConsts.js';import{Consts}from'./Consts.js';import{UtilApplications}from'./UtilApplications.js';import{Config}from'./Config.js';import{UtilPatch}from'./UtilPatch.js';import{LGT}from'./Util.js';class Patcher{static[_0x1aca('0x5')](){this[_0x1aca('0x25')](),this['_doPatchJournalContextMenuOptions'](),Hooks['on'](_0x1aca('0x1b'),()=>this[_0x1aca('0x32')]()),this[_0x1aca('0x32')]();}static[_0x1aca('0x32')](){Patcher[_0x1aca('0x29')][_0x1aca('0x61')](),JournalSheet_Plutonium[_0x1aca('0x65')]();}static[_0x1aca('0x25')](){const _0x7a9813=ui['actors'][_0x1aca('0x54')][_0x1aca('0x41')](ui['actors']);ui[_0x1aca('0x4e')][_0x1aca('0x54')]=()=>{const _0x2036d6=_0x7a9813();return _0x2036d6[_0x1aca('0x13')]({'name':'Set\x20as\x20Rivet\x20Target','icon':_0x1aca('0x16'),'condition':_0x15d723=>{const _0x4cf3ef=ActorDirectory[_0x1aca('0x2a')]['get'](_0x15d723['data']('entityId'));return _0x4cf3ef[_0x1aca('0x1f')];},'callback':_0x26868d=>{const _0x49facf=ActorDirectory[_0x1aca('0x2a')][_0x1aca('0x45')](_0x26868d[_0x1aca('0x4a')](_0x1aca('0x35')));Config[_0x1aca('0x11')](_0x1aca('0x3'),_0x1aca('0x44'),_0x49facf['id']),ui['notifications'][_0x1aca('0x51')](_0x1aca('0x12')+_0x49facf['id']+'\x22.\x20This\x20can\x20be\x20changed\x20in\x20the\x20Config.');}}),_0x2036d6;};}static[_0x1aca('0x40')](){const _0x26444e=ui[_0x1aca('0x33')][_0x1aca('0x54')][_0x1aca('0x41')](ui[_0x1aca('0x33')]);ui['journal'][_0x1aca('0x54')]=()=>{const _0x770258=_0x26444e(),_0x2e7641=_0x770258[_0x1aca('0x2')](_0x2c1528=>_0x2c1528[_0x1aca('0x58')]==='SIDEBAR.Permissions');if(!~_0x2e7641)return _0x770258;return _0x770258['splice'](_0x2e7641+0x1,0x0,{'name':'Set\x20Embed\x20URL','icon':_0x1aca('0x18'),'condition':_0x2f478a=>{if(!Config[_0x1aca('0x45')](_0x1aca('0x5c'),_0x1aca('0xe')))return![];const _0x46d961=JournalDirectory[_0x1aca('0x2a')][_0x1aca('0x45')](_0x2f478a[_0x1aca('0x4a')](_0x1aca('0x35')));return _0x46d961[_0x1aca('0x1f')];},'callback':async _0x3bbbc4=>{const _0x38ea43=JournalDirectory['collection']['get'](_0x3bbbc4[_0x1aca('0x4a')](_0x1aca('0x35'))),_0x48e198=await _0x38ea43[_0x1aca('0x4')](SharedConsts[_0x1aca('0x0')],Consts['FLAG_IFRAME_URL']);let _0x2dd4e4=await InputUiUtil[_0x1aca('0x26')]({'title':_0x1aca('0x28'),'default':_0x48e198||''});if(_0x2dd4e4==null)return;Object[_0x1aca('0x5f')](_0x38ea43[_0x1aca('0x7')])[_0x1aca('0x39')](_0xd4117c=>{_0xd4117c[_0x1aca('0x47')]?_0xd4117c[_0x1aca('0x47')]():_0xd4117c[_0x1aca('0x23')]();});if(!_0x2dd4e4)await _0x38ea43['setFlag'](SharedConsts[_0x1aca('0x0')],Consts[_0x1aca('0x19')],'');else{_0x2dd4e4=_0x2dd4e4[_0x1aca('0xf')]();if(_0x2dd4e4[_0x1aca('0x22')](_0x1aca('0x1c')))_0x2dd4e4=$(_0x2dd4e4)[_0x1aca('0xc')](_0x1aca('0x5a'));!_0x2dd4e4&&(ui[_0x1aca('0xd')]['warn'](_0x1aca('0x2c')+_0x2dd4e4+_0x1aca('0x1a')),await _0x38ea43['setFlag'](SharedConsts[_0x1aca('0x0')],Consts[_0x1aca('0x19')],'')),await _0x38ea43[_0x1aca('0x59')](SharedConsts[_0x1aca('0x0')],Consts[_0x1aca('0x19')],_0x2dd4e4);}}}),_0x770258;};}}Patcher['Token']=class{static[_0x1aca('0x32')](){this[_0x1aca('0x61')]();}static[_0x1aca('0x61')](){const _0x28e9ad=UtilPatch[_0x1aca('0x14')](Token[_0x1aca('0x5b')],_0x1aca('0x38')),_0x52b4e8=UtilPatch[_0x1aca('0x14')](Token[_0x1aca('0x5b')],_0x1aca('0x55')),_0x28590b=UtilPatch[_0x1aca('0x14')](Token[_0x1aca('0x5b')],'_onUpdateTokenActor'),_0x1a1b12=UtilPatch[_0x1aca('0x14')](Token['prototype'],_0x1aca('0x52'));if(!Config['get'](_0x1aca('0x53'),_0x1aca('0x2b'))){UtilPatch[_0x1aca('0x62')](Token[_0x1aca('0x5b')],_0x1aca('0x38')),UtilPatch[_0x1aca('0x62')](Token['prototype'],_0x1aca('0x55')),UtilPatch['restoreCachedMethod'](Token[_0x1aca('0x5b')],_0x1aca('0x36')),UtilPatch[_0x1aca('0x62')](Token[_0x1aca('0x5b')],_0x1aca('0x52')),this['_handleConfigUpdate_displayDamageDealt_doRefreshTokens']({'isRemoveDisplays':!![]});return;}Token['prototype'][_0x1aca('0x38')]=function(..._0x1534ef){Patcher[_0x1aca('0x29')][_0x1aca('0x6')](this),_0x28e9ad[_0x1aca('0x41')](this)(..._0x1534ef);},Token[_0x1aca('0x5b')][_0x1aca('0x55')]=function(..._0x554f15){Patcher[_0x1aca('0x29')]['_handleConfigUpdate_displayDamageDealt_doUpdateDisplay'](this),_0x52b4e8[_0x1aca('0x41')](this)(..._0x554f15);},Token[_0x1aca('0x5b')][_0x1aca('0x36')]=function(..._0x3b93b8){Patcher[_0x1aca('0x29')][_0x1aca('0x6')](this),_0x28590b['bind'](this)(..._0x3b93b8);},Token[_0x1aca('0x5b')][_0x1aca('0x52')]=function(..._0xd84e1){Patcher[_0x1aca('0x29')][_0x1aca('0x6')](this),_0x1a1b12['bind'](this)(..._0xd84e1);},this[_0x1aca('0x1')]();}static['_handleConfigUpdate_displayDamageDealt_doRefreshTokens'](_0x3e4450){_0x3e4450=_0x3e4450||{};const _0x335728=MiscUtil['get'](canvas,_0x1aca('0x53'),_0x1aca('0x64'))||[];for(const _0x4a8760 of _0x335728){try{_0x3e4450[_0x1aca('0x4d')]&&_0x4a8760[_0x1aca('0x3c')]&&(_0x4a8760[_0x1aca('0x56')](_0x4a8760[_0x1aca('0x3c')]),_0x4a8760[_0x1aca('0x3c')]=null),_0x4a8760[_0x1aca('0x38')]();}catch(_0x933cb8){console[_0x1aca('0x43')](...LGT,'Failed\x20to\x20refresh\x20token\x20\x22'+_0x4a8760[_0x1aca('0xa')]+'\x22!',_0x933cb8);}}}static[_0x1aca('0x6')](_0x56990c){this[_0x1aca('0x4b')](_0x56990c);const _0x3d3432=MiscUtil[_0x1aca('0x45')](_0x56990c[_0x1aca('0x24')],'data','data','attributes','hp',_0x1aca('0x2e'))||0x0,_0x4a254e=MiscUtil['get'](_0x56990c['actor'],_0x1aca('0x4a'),'data','attributes','hp',_0x1aca('0x5e'))||0x0,_0x3991f4=Math[_0x1aca('0x31')](_0x3d3432,Math['max'](0x0,_0x3d3432-_0x4a254e));_0x56990c[_0x1aca('0x3c')][_0x1aca('0xb')]=''+_0x3991f4,_0x56990c[_0x1aca('0x3c')][_0x1aca('0x27')]=!!_0x3991f4;if(_0x4a254e<=Math['floor'](_0x3d3432/0x2))_0x56990c['_plutonium_xDispDamageDealt'][_0x1aca('0x60')]['fill']=0xff0000;else _0x56990c['_plutonium_xDispDamageDealt'][_0x1aca('0x60')][_0x1aca('0x49')]=0xffffff;}static['_handleConfigUpdate_displayDamageDealt_doAddDisplay'](_0x2a1cc6){if(_0x2a1cc6[_0x1aca('0x3c')]&&_0x2a1cc6[_0x1aca('0x3c')][_0x1aca('0x15')])return;_0x2a1cc6[_0x1aca('0x3c')]&&!_0x2a1cc6[_0x1aca('0x3c')][_0x1aca('0x15')]&&(_0x2a1cc6[_0x1aca('0x56')](_0x2a1cc6[_0x1aca('0x3c')]),_0x2a1cc6[_0x1aca('0x3c')]=null),_0x2a1cc6[_0x1aca('0x3c')]=new PIXI['Text']('',CONFIG[_0x1aca('0x30')][_0x1aca('0x3d')]()),_0x2a1cc6[_0x1aca('0x3c')][_0x1aca('0x60')][_0x1aca('0x3a')]=0x18,_0x2a1cc6[_0x1aca('0x3c')]['anchor'][_0x1aca('0x11')](0x1,0x1),_0x2a1cc6[_0x1aca('0x3c')][_0x1aca('0x42')][_0x1aca('0x11')](_0x2a1cc6['w']-0x3,_0x2a1cc6['h']-0x1),_0x2a1cc6['addChild'](_0x2a1cc6[_0x1aca('0x3c')]);}};class JournalSheet_Plutonium extends JournalSheet{static[_0x1aca('0x65')](){const _0x20632c=Config[_0x1aca('0x45')](_0x1aca('0x5c'),_0x1aca('0xe'));if(JournalSheet_Plutonium[_0x1aca('0x4c')]===_0x20632c)return;JournalSheet_Plutonium[_0x1aca('0x4c')]=_0x20632c;if(_0x20632c)JournalSheet_Plutonium[_0x1aca('0x5d')]();else JournalSheet_Plutonium[_0x1aca('0x9')]();}static[_0x1aca('0x5d')](){JournalSheet_Plutonium[_0x1aca('0x3f')]=!![],JournalSheet=JournalSheet_Plutonium,CONFIG[_0x1aca('0x8')][_0x1aca('0x57')]=JournalSheet_Plutonium;}static[_0x1aca('0x9')](){if(!JournalSheet_Plutonium[_0x1aca('0x3f')])return;JournalSheet=JournalSheet_Plutonium[_0x1aca('0x34')],CONFIG['JournalEntry']['sheetClass']=JournalSheet_Plutonium[_0x1aca('0x34')],Object[_0x1aca('0x5f')](ui[_0x1aca('0x17')])['forEach'](_0xf4336a=>{_0xf4336a[_0x1aca('0x1e')]===JournalSheet_Plutonium&&_0xf4336a[_0x1aca('0x63')]['getFlag'](SharedConsts[_0x1aca('0x0')],Consts[_0x1aca('0x19')])&&_0xf4336a['forceClose']();});}static get[_0x1aca('0x58')](){return _0x1aca('0x2f');}static get[_0x1aca('0x2d')](){return{...super[_0x1aca('0x2d')],'template':SharedConsts[_0x1aca('0x3e')]+_0x1aca('0x10')};}get[_0x1aca('0x37')](){if(this[_0x1aca('0x48')]===_0x1aca('0x21'))return ImagePopout['defaultOptions'][_0x1aca('0x37')];return SharedConsts[_0x1aca('0x3e')]+'/mod-template/journal/sheet.handlebars';}[_0x1aca('0x23')](..._0x3edd6f){if(this['object']&&this['object'][_0x1aca('0x4')](SharedConsts[_0x1aca('0x0')],Consts[_0x1aca('0x19')])){this[_0x1aca('0x1d')]['hideVe']();return;}super[_0x1aca('0x23')](..._0x3edd6f);}[_0x1aca('0x47')](){super[_0x1aca('0x23')]();}[_0x1aca('0x20')](..._0x5ec07a){if(_0x5ec07a[0x1]&&_0x5ec07a[0x1][_0x1aca('0x50')]!==this[_0x1aca('0x48')])return super[_0x1aca('0x20')](..._0x5ec07a);if(this[_0x1aca('0x1d')]&&this[_0x1aca('0x1d')]['length']){this[_0x1aca('0x1d')][_0x1aca('0x46')](),this['maximize'](),UtilApplications[_0x1aca('0x3b')](this);return;}super[_0x1aca('0x20')](..._0x5ec07a);}}JournalSheet_Plutonium[_0x1aca('0x4f')]=![],JournalSheet_Plutonium[_0x1aca('0x34')]=JournalSheet,JournalSheet_Plutonium['_LAST_IS_ENABLED']=null;export{Patcher};