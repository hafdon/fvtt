const _0xf7d9=['count','item','1yaViNi','getTokens','74KWQCXJ','getAbilityModNumber','shift','tokens','find','ctrlKey','name','11wJZZwD','items','textToNumber','text','fake','toLowerCase','abilities','_pHandleCreateChatMessage','init','2164317EWZjQP','test','_pHandleCreateChatMessage_handleMeleeRangedAttacks','content','attr','error','max','rollItem','simpleR','modules','simpleM','weapon','_getActionByLowerName','value','2qIEftC','includes','evl','getTree3','3461NbCynF','mwak','filter','undefined','\x22></div>','tree','imageButtonEnabled','multiattack','actionType','sheet','pDelay','midi-qol','weaponType','34617OgHcTE','collection','forEach','2109lWLfUK','ascSort','push','495366lyvLFr','8amQiNJ','TITLE_LOWER_WORDS','meanDamage','parts','join','Failed\x20to\x20evaluate\x20damage\x20part\x20\x22','deepEquals','avg(','map','data','roll','101683AnNqyA','_onItemRoll','type','getWithoutParens','length','actor','isPunctuation','melee','properties','isCapsFirst','dice','endsWith','settings','with','speaker','description','pop','448418auwJrd','slice','last','reduce','martialM','values','_pHandleCreateChatMessage_mutExtractSimpleAttacks','betterrolls5e','rwak','replace','and','createChatMessage','trim','split','its','_pHandleCreateChatMessage_mutExtractNamedActions','thr','get'];const _0x4de6=function(_0x21abac,_0x16b26a){_0x21abac=_0x21abac-0x110;let _0xf7d9c0=_0xf7d9[_0x21abac];return _0xf7d9c0;};const _0x3204c9=_0x4de6;(function(_0x35e22e,_0x4dcd98){const _0x211605=_0x4de6;while(!![]){try{const _0x28912e=parseInt(_0x211605(0x116))*-parseInt(_0x211605(0x112))+parseInt(_0x211605(0x177))*-parseInt(_0x211605(0x14f))+parseInt(_0x211605(0x121))*-parseInt(_0x211605(0x166))+parseInt(_0x211605(0x148))*-parseInt(_0x211605(0x16a))+-parseInt(_0x211605(0x132))*parseInt(_0x211605(0x146))+-parseInt(_0x211605(0x115))+parseInt(_0x211605(0x158));if(_0x28912e===_0x4dcd98)break;else _0x35e22e['push'](_0x35e22e['shift']());}catch(_0x5e4fa2){_0x35e22e['push'](_0x35e22e['shift']());}}}(_0xf7d9,0x58b82));import{Config}from'./Config.js';import{LGT,Util}from'./Util.js';import{Consts}from'./Consts.js';class ActorMultiattack{static[_0x3204c9(0x157)](){const _0x4ddd56=_0x3204c9;Hooks['on'](_0x4ddd56(0x13d),(_0x42f36a,_0x3854b5,_0x2fb1ef)=>{const _0x133f65=_0x4ddd56;this[_0x133f65(0x156)](_0x42f36a,_0x3854b5,_0x2fb1ef);});}static async[_0x3204c9(0x156)](_0x2e728a,_0x5b4812,_0x24a38a){const _0x1a8ee0=_0x3204c9;if(!Config['get'](_0x1a8ee0(0x126),'isAutoMultiattack'))return;if(_0x24a38a!==game['userId'])return;const _0x410568=MiscUtil[_0x1a8ee0(0x143)](_0x2e728a,_0x1a8ee0(0x11f),_0x1a8ee0(0x12f),_0x1a8ee0(0x126));if(!_0x410568)return;const _0xbf9d16=Actor[_0x1a8ee0(0x110)]['get'](_0x410568);if(!_0xbf9d16)return;const _0x4cf9e6=$(_0x2e728a[_0x1a8ee0(0x11f)][_0x1a8ee0(0x15b)]||'')[_0x1a8ee0(0x15c)]('data-item-id');if(!_0x4cf9e6)return;const _0x539fe5=_0xbf9d16[_0x1a8ee0(0x150)]['get'](_0x4cf9e6),_0x4f06b1=Util[_0x1a8ee0(0x124)](_0x539fe5['name'])[_0x1a8ee0(0x154)]();if(_0x4f06b1!==_0x1a8ee0(0x171))return;const _0xe84c79=$(_0x539fe5['data'][_0x1a8ee0(0x11f)][_0x1a8ee0(0x130)][_0x1a8ee0(0x165)])[_0x1a8ee0(0x152)]()[_0x1a8ee0(0x13e)]();if(!_0xe84c79)return;const _0x50c946=_0xe84c79[_0x1a8ee0(0x13f)](/[.?!]/g)['map'](_0x47f0b4=>_0x47f0b4[_0x1a8ee0(0x13e)]())[_0x1a8ee0(0x16c)](Boolean),_0x2f29f9=[];this[_0x1a8ee0(0x141)](_0xbf9d16,_0x50c946,_0x2f29f9),this[_0x1a8ee0(0x138)](_0xbf9d16,_0x50c946,_0x2f29f9);for(const _0x37b57c of _0x2f29f9){for(let _0x40518c=0x0;_0x40518c<_0x37b57c['count'];++_0x40518c){const _0x5a278c={'preventDefault':()=>{},'stopPropagation':()=>{},'currentTarget':$('<div\x20class=\x22item\x22\x20data-item-id=\x22'+_0x37b57c[_0x1a8ee0(0x145)]['_id']+_0x1a8ee0(0x16e))[0x0]};if(typeof BetterRolls!==_0x1a8ee0(0x16d)){const _0x5c79ae=new Event(_0x1a8ee0(0x153));_0x5c79ae[_0x1a8ee0(0x14d)]=![],_0x5c79ae['shiftKey']=![],_0x5c79ae['altKey']=![];const _0x112f10={'adv':0x0,'disadv':0x0,'event':_0x5c79ae};!game[_0x1a8ee0(0x12d)][_0x1a8ee0(0x143)](_0x1a8ee0(0x139),_0x1a8ee0(0x170))?_0x37b57c[_0x1a8ee0(0x145)][_0x1a8ee0(0x126)][_0x1a8ee0(0x173)][_0x1a8ee0(0x122)](_0x5a278c):await BetterRolls[_0x1a8ee0(0x15f)](_0x37b57c[_0x1a8ee0(0x145)],mergeObject(_0x112f10,{'preset':0x0}))['toMessage']();}else await _0x37b57c[_0x1a8ee0(0x145)][_0x1a8ee0(0x120)]();if(game[_0x1a8ee0(0x161)]['get'](_0x1a8ee0(0x175))?.['active']){if(_0x40518c<_0x37b57c['count'])await MiscUtil[_0x1a8ee0(0x174)](0x14d);}}}}static[_0x3204c9(0x141)](_0x56b0e6,_0x4a988a,_0x40954e){const _0x4388b7=_0x3204c9;_0x4a988a[_0x4388b7(0x111)](_0x251a31=>{const _0x594a08=_0x4388b7;let _0x20814e=Util[_0x594a08(0x147)](_0x251a31);while((Util[_0x594a08(0x127)](_0x20814e[0x0])||Util['isCapsFirst'](_0x20814e[0x0]))&&_0x20814e[_0x594a08(0x125)])_0x20814e['shift']();_0x20814e=_0x20814e[_0x594a08(0x11e)](_0x8992fe=>_0x8992fe[_0x594a08(0x13e)]())[_0x594a08(0x16c)](Boolean);const _0x6dc602=[];let _0x5526cb=[],_0x1b3872={};const _0x1f00cc=()=>{const _0x55c815=_0x594a08;if(!_0x5526cb[_0x55c815(0x125)])return;while(_0x5526cb[_0x55c815(0x125)]){if(StrUtil[_0x55c815(0x117)][_0x55c815(0x167)](_0x5526cb[_0x55c815(0x134)]()))_0x5526cb[_0x55c815(0x131)]();else break;}_0x6dc602[_0x55c815(0x114)]({'name':_0x5526cb[_0x55c815(0x11a)]('\x20'),'count':_0x1b3872[_0x55c815(0x144)]||0x1}),_0x5526cb=[],_0x1b3872={};};for(let _0x21bed1=0x0;_0x21bed1<_0x20814e[_0x594a08(0x125)];++_0x21bed1){const _0x128308=_0x20814e[_0x21bed1];if(Util[_0x594a08(0x12a)](_0x128308))_0x5526cb[_0x594a08(0x114)](_0x128308);else{if(_0x5526cb[_0x594a08(0x125)]&&StrUtil[_0x594a08(0x117)][_0x594a08(0x167)](_0x128308))_0x5526cb[_0x594a08(0x114)](_0x128308);else{const _0x1543a4=Consts['TERMS_COUNT']['find'](_0x149dfc=>{const _0x4e8a42=_0x594a08,_0x231231=_0x20814e[_0x4e8a42(0x133)](_0x21bed1,_0x21bed1+_0x149dfc['tokens'][_0x4e8a42(0x125)]);return CollectionUtil[_0x4e8a42(0x11c)](_0x149dfc[_0x4e8a42(0x14b)],_0x231231);});_0x5526cb[_0x594a08(0x125)]&&_0x1543a4&&(_0x21bed1+=_0x1543a4[_0x594a08(0x14b)][_0x594a08(0x125)]-0x1,_0x1b3872[_0x594a08(0x144)]=_0x1543a4[_0x594a08(0x144)]),_0x1f00cc();}}}_0x1f00cc(),_0x6dc602[_0x594a08(0x111)](_0x19b342=>{const _0x527cce=_0x594a08,_0x145d2c=_0x19b342[_0x527cce(0x14e)][_0x527cce(0x154)]()[_0x527cce(0x13e)](),_0xd87912=_0x56b0e6[_0x527cce(0x150)]['find'](_0x47c2b4=>Util[_0x527cce(0x124)](_0x47c2b4[_0x527cce(0x14e)])[_0x527cce(0x154)]()===_0x145d2c);if(!_0xd87912)return;_0x40954e[_0x527cce(0x114)]({'item':_0xd87912,'count':_0x19b342[_0x527cce(0x144)]||0x1});});});}static[_0x3204c9(0x138)](_0x46bbf1,_0x3b6ad6,_0x535185){const _0x516f72=_0x3204c9;_0x3b6ad6[_0x516f72(0x111)](_0x17096d=>{const _0x902aae=_0x516f72;_0x17096d=_0x17096d[_0x902aae(0x13b)](/(two|three|four|five|six|seven|eight) (.*?) attacks/gi,(..._0x34fb78)=>{const _0x522387=_0x902aae,_0x4783bf=_0x34fb78[0x1][_0x522387(0x154)](),_0x2beeea=Parser['textToNumber'](_0x4783bf),_0x11d3c4=Util['getWithoutParens'](_0x34fb78[0x2])[_0x522387(0x154)]();if(_0x11d3c4===_0x522387(0x128)||_0x11d3c4==='ranged')return this[_0x522387(0x15a)](_0x46bbf1,_0x11d3c4,_0x2beeea,_0x535185),'';const _0x5819bb=_0x46bbf1['items']['find'](_0x464bb9=>Util[_0x522387(0x124)](_0x464bb9[_0x522387(0x14e)])[_0x522387(0x154)]()===_0x11d3c4);if(!_0x5819bb)return _0x34fb78[0x0];return _0x535185['push']({'item':_0x5819bb,'count':_0x2beeea}),'';}),_0x17096d=_0x17096d['replace'](/makes (two|three|four|five|six|seven|eight) attacks with its (.*? or .*?)$/gi,(..._0x1f79a6)=>{const _0x395375=_0x902aae,_0x591af6=_0x1f79a6[0x1];let _0x472c97=_0x1f79a6[0x2];const _0xecc7f6=Util[_0x395375(0x147)](_0x472c97);while(_0xecc7f6[_0x395375(0x125)]){const _0x231b7e=[];for(let _0x4aa5c9=0x0;_0x4aa5c9<_0xecc7f6[_0x395375(0x125)];++_0x4aa5c9){const _0x55911b=_0xecc7f6[_0x4aa5c9][_0x395375(0x154)]();if(_0x55911b===_0x395375(0x13c)||_0x55911b==='or'||_0x55911b===_0x395375(0x140)||_0x55911b===_0x395375(0x12e)||Util[_0x395375(0x127)](_0x55911b)){_0xecc7f6[_0x395375(0x14a)]();break;}else _0x231b7e[_0x395375(0x114)](_0xecc7f6[_0x395375(0x14a)]()),_0x4aa5c9--;}if(_0x231b7e[_0x395375(0x125)]){const _0x3a8466=_0x231b7e[_0x395375(0x11a)]('')[_0x395375(0x13e)](),_0x57c2db=this[_0x395375(0x164)](_0x46bbf1,_0x3a8466);_0x57c2db&&_0x535185['push']({'item':_0x57c2db,'count':Parser[_0x395375(0x151)](_0x591af6)});}}return _0xecc7f6[_0x395375(0x11a)]('')[_0x395375(0x13e)]();}),_0x17096d=_0x17096d['replace'](/makes (?:two|three|four|five|six|seven|eight) attacks:(.*?)$/gi,(..._0xdbf731)=>{const _0x153102=_0x902aae;let _0x39211f=_0xdbf731[0x1],_0x1835cc=![],_0x36c118=null;while(_0x39211f[_0x153102(0x125)]&&_0x39211f!==_0x36c118){_0x36c118=_0x39211f,_0x39211f=_0x39211f[_0x153102(0x13b)](/(one|two|three|four|five|six|seven|eight) with (?:its |his |her )(.*)/gi,(..._0x6f6bbc)=>{const _0x4b642b=_0x153102,_0x1ac99b=_0x6f6bbc[0x1],_0x1d5f41=_0x6f6bbc[0x2],_0x18cceb=[],_0x4bfb7a=Util[_0x4b642b(0x147)](_0x1d5f41);for(let _0x354cda=0x0;_0x354cda<_0x4bfb7a[_0x4b642b(0x125)];++_0x354cda){const _0x41e97e=_0x4bfb7a[_0x354cda][_0x4b642b(0x154)]();if(_0x41e97e===_0x4b642b(0x13c)||_0x41e97e==='or'||Util[_0x4b642b(0x127)](_0x41e97e)){_0x4bfb7a['shift']();break;}else _0x18cceb[_0x4b642b(0x114)](_0x4bfb7a[_0x4b642b(0x14a)]()),_0x354cda--;}if(_0x18cceb[_0x4b642b(0x125)]){const _0x54f637=_0x18cceb['join']('')[_0x4b642b(0x13e)](),_0x176561=this[_0x4b642b(0x164)](_0x46bbf1,_0x54f637);_0x176561&&_0x535185[_0x4b642b(0x114)]({'item':_0x176561,'count':Parser[_0x4b642b(0x151)](_0x1ac99b)});}return _0x4bfb7a['join']('')['trim']();});}if(_0x1835cc)return'';return _0xdbf731[0x0];});});}static[_0x3204c9(0x15a)](_0x2a2ea8,_0x326467,_0x3ee79b,_0xd6c741){const _0x3b4fcb=_0x3204c9;let _0x2f5d9f;const _0x2983d2=[],_0x4404d2=[];_0x2a2ea8['items'][_0x3b4fcb(0x16c)](_0x13f890=>_0x13f890[_0x3b4fcb(0x123)]===_0x3b4fcb(0x163))[_0x3b4fcb(0x111)](_0x13cb3a=>{const _0x257b65=_0x3b4fcb,_0x336844=MiscUtil[_0x257b65(0x143)](_0x13cb3a,_0x257b65(0x11f),'data');if(!_0x336844)return;const _0x5f5650=MiscUtil[_0x257b65(0x143)](_0x336844,_0x257b65(0x176));switch(_0x5f5650){case _0x257b65(0x162):case _0x257b65(0x136):{_0x2983d2['push'](_0x13cb3a);if(MiscUtil[_0x257b65(0x143)](_0x336844,_0x257b65(0x129),_0x257b65(0x142)))_0x4404d2[_0x257b65(0x114)](_0x13cb3a);return;}case _0x257b65(0x160):case'martialR':{_0x4404d2[_0x257b65(0x114)](_0x13cb3a);return;}}const _0x3dced0=MiscUtil[_0x257b65(0x143)](_0x336844,_0x257b65(0x172));switch(_0x3dced0){case _0x257b65(0x16b):{_0x2983d2['push'](_0x13cb3a);if(MiscUtil[_0x257b65(0x143)](_0x336844,_0x257b65(0x129),_0x257b65(0x142)))_0x4404d2['push'](_0x13cb3a);return;}case _0x257b65(0x13a):{_0x4404d2[_0x257b65(0x114)](_0x13cb3a);return;}}const _0x39e889=(MiscUtil['get'](_0x336844,'description',_0x257b65(0x165))||'')[_0x257b65(0x13b)](/[^a-zA-Z0-9:.,()]/g,'')[_0x257b65(0x13b)](/\s+/g,'\x20')[_0x257b65(0x13e)]();if(/melee or ranged weapon attack:/i[_0x257b65(0x159)](_0x39e889))_0x2983d2[_0x257b65(0x114)](_0x13cb3a),_0x4404d2[_0x257b65(0x114)](_0x13cb3a);else{if(/melee weapon attack:/i[_0x257b65(0x159)](_0x39e889))_0x2983d2[_0x257b65(0x114)](_0x13cb3a);else/ranged weapon attack:/i[_0x257b65(0x159)](_0x39e889)&&_0x4404d2[_0x257b65(0x114)](_0x13cb3a);}});const _0x1fd5a8=_0x326467===_0x3b4fcb(0x128)?_0x2983d2:_0x4404d2;_0x2f5d9f=_0x1fd5a8[_0x3b4fcb(0x11e)](_0x4c5feb=>{const _0x197740=_0x3b4fcb,_0x3db623=MiscUtil['get'](_0x4c5feb,_0x197740(0x11f),_0x197740(0x11f),'damage',_0x197740(0x119));if(!_0x3db623)return null;const _0x39ac06=_0x3db623['map'](_0x4f88b6=>{const _0x238a05=_0x197740;try{const _0x231bd3=_0x4f88b6[0x0]['replace'](/@mod/gi,()=>{const _0x31e5c4=_0x4de6,_0x5def96=_0x4c5feb['abilityMod'];if(!_0x5def96)return 0x0;const _0x5b683a=MiscUtil[_0x31e5c4(0x143)](_0x2a2ea8,_0x31e5c4(0x11f),_0x31e5c4(0x11f),_0x31e5c4(0x155),_0x31e5c4(0x165))||0xa;return Parser[_0x31e5c4(0x149)](_0x5b683a);}),_0x33b838=Renderer[_0x238a05(0x12b)]['lang'][_0x238a05(0x169)](_0x238a05(0x11d)+_0x231bd3+')');return{'type':_0x4f88b6[0x1],'meanDamage':_0x33b838[_0x238a05(0x16f)][_0x238a05(0x168)]({})};}catch(_0xecf9d5){return console[_0x238a05(0x15d)](...LGT,_0x238a05(0x11b)+_0x4f88b6[0x0]+'\x22',_0xecf9d5),null;}})[_0x197740(0x16c)](Boolean);if(!_0x39ac06['length'])return null;const _0x4f7dc8={};_0x39ac06['forEach'](_0x57cfa7=>_0x4f7dc8[_0x57cfa7[_0x197740(0x123)]]=Math[_0x197740(0x15e)](_0x57cfa7[_0x197740(0x118)],_0x4f7dc8[_0x57cfa7[_0x197740(0x123)]]||0x0));const _0x278881=Object[_0x197740(0x137)](_0x4f7dc8)[_0x197740(0x135)]((_0x3fe397,_0x45edef)=>_0x3fe397+_0x45edef,0x0);return{'item':_0x4c5feb,'meanDamage':_0x278881};})[_0x3b4fcb(0x16c)](Boolean)['sort']((_0x3cc41a,_0x4fa97f)=>SortUtil[_0x3b4fcb(0x113)](_0x4fa97f[_0x3b4fcb(0x118)],_0x3cc41a[_0x3b4fcb(0x118)]))[_0x3b4fcb(0x11e)](_0x12ade6=>_0x12ade6[_0x3b4fcb(0x145)])[_0x3b4fcb(0x14c)](Boolean);if(!_0x2f5d9f&&_0x1fd5a8[0x0])_0x2f5d9f=_0x1fd5a8[0x0];else{if(!_0x2f5d9f&&!_0x1fd5a8[0x0])return;}_0xd6c741['push']({'item':_0x2f5d9f,'count':_0x3ee79b});}static[_0x3204c9(0x164)](_0x1d3acd,_0x53dcfe){const _0x1ee8d1=_0x3204c9;let _0x14d9b0=_0x1d3acd[_0x1ee8d1(0x150)][_0x1ee8d1(0x14c)](_0x690003=>Util['getWithoutParens'](_0x690003[_0x1ee8d1(0x14e)])[_0x1ee8d1(0x154)]()===_0x53dcfe);if(!_0x14d9b0&&_0x53dcfe[_0x1ee8d1(0x12c)]('s')){const _0x3553b9=_0x53dcfe[_0x1ee8d1(0x133)](0x0,-0x1);_0x14d9b0=_0x1d3acd[_0x1ee8d1(0x150)][_0x1ee8d1(0x14c)](_0x1ebaed=>Util['getWithoutParens'](_0x1ebaed[_0x1ee8d1(0x14e)])[_0x1ee8d1(0x154)]()===_0x3553b9);}return _0x14d9b0;}}export{ActorMultiattack};