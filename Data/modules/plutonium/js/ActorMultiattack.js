const _0x5141=['_pHandleCreateChatMessage_mutExtractNamedActions','imageButtonEnabled','name','toLowerCase','max','length','118657mrtjMr','\x22></div>','getAbilityModNumber','shiftKey','dice','values','sheet','_id','filter','isAutoMultiattack','items','push','map','modules','martialM','with','melee','shift','item','join','speaker','getTree3','actionType','slice','get','endsWith','properties','TERMS_COUNT','_pHandleCreateChatMessage','ascSort','_getActionByLowerName','tokens','getWithoutParens','_pHandleCreateChatMessage_mutExtractSimpleAttacks','simpleR','and','textToNumber','damage','multiattack','deepEquals','type','17789zkGehT','rollItem','init','forEach','weapon','lang','userId','find','mwak','abilities','includes','test','Failed\x20to\x20evaluate\x20damage\x20part\x20\x22','undefined','sort','active','content','weaponType','_onItemRoll','evl','value','meanDamage','rwak','last','toMessage','trim','split','data','425433BVewnA','avg(','actor','ranged','thr','4330MfyNYu','5AuOrcu','getTokens','reduce','isCapsFirst','1410679ufAhoo','201911pBqUaG','text','pop','TITLE_LOWER_WORDS','isPunctuation','fake','33323efbcLp','attr','replace','5exUdKL','count','_pHandleCreateChatMessage_handleMeleeRangedAttacks','ctrlKey','parts','its','description','14njureL','midi-qol','abilityMod','createChatMessage'];const _0x318a=function(_0x4a634d,_0x482162){_0x4a634d=_0x4a634d-0x154;let _0x5141f2=_0x5141[_0x4a634d];return _0x5141f2;};const _0x31302b=_0x318a;(function(_0x38b953,_0x8c3ef3){const _0x4e69d6=_0x318a;while(!![]){try{const _0x16aad4=-parseInt(_0x4e69d6(0x192))*parseInt(_0x4e69d6(0x173))+-parseInt(_0x4e69d6(0x178))+-parseInt(_0x4e69d6(0x17e))*parseInt(_0x4e69d6(0x188))+-parseInt(_0x4e69d6(0x172))+-parseInt(_0x4e69d6(0x181))*parseInt(_0x4e69d6(0x1bb))+parseInt(_0x4e69d6(0x16d))+parseInt(_0x4e69d6(0x177));if(_0x16aad4===_0x8c3ef3)break;else _0x38b953['push'](_0x38b953['shift']());}catch(_0x4bdc51){_0x38b953['push'](_0x38b953['shift']());}}}(_0x5141,0x7575f));import{Config}from'./Config.js';import{LGT,Util}from'./Util.js';import{Consts}from'./Consts.js';class ActorMultiattack{static[_0x31302b(0x1bd)](){const _0x3f5f95=_0x31302b;Hooks['on'](_0x3f5f95(0x18b),(_0x20b428,_0x129ad5,_0x79e10f)=>{const _0x549d9b=_0x3f5f95;this[_0x549d9b(0x1ae)](_0x20b428,_0x129ad5,_0x79e10f);});}static async[_0x31302b(0x1ae)](_0x2c3441,_0xf3f257,_0x7c74c6){const _0xc22016=_0x31302b;if(!Config[_0xc22016(0x1aa)]('actor',_0xc22016(0x19b)))return;if(_0x7c74c6!==game[_0xc22016(0x157)])return;const _0x4d83f7=MiscUtil['get'](_0x2c3441,_0xc22016(0x16c),_0xc22016(0x1a6),_0xc22016(0x16f));if(!_0x4d83f7)return;const _0x3b749c=Actor['collection'][_0xc22016(0x1aa)](_0x4d83f7);if(!_0x3b749c)return;const _0x16c2db=$(_0x2c3441[_0xc22016(0x16c)][_0xc22016(0x161)]||'')[_0xc22016(0x17f)]('data-item-id');if(!_0x16c2db)return;const _0x3b4a0f=_0x3b749c[_0xc22016(0x19c)][_0xc22016(0x1aa)](_0x16c2db),_0x4bb3a0=Util[_0xc22016(0x1b2)](_0x3b4a0f['name'])[_0xc22016(0x18f)]();if(_0x4bb3a0!=='multiattack')return;const _0x522c1f=$(_0x3b4a0f[_0xc22016(0x16c)][_0xc22016(0x16c)][_0xc22016(0x187)][_0xc22016(0x165)])[_0xc22016(0x179)]()[_0xc22016(0x16a)]();if(!_0x522c1f)return;const _0x1ad7df=_0x522c1f[_0xc22016(0x16b)](/[.?!]/g)[_0xc22016(0x19e)](_0x148ab9=>_0x148ab9[_0xc22016(0x16a)]())[_0xc22016(0x19a)](Boolean),_0x5659a9=[];this[_0xc22016(0x18c)](_0x3b749c,_0x1ad7df,_0x5659a9),this[_0xc22016(0x1b3)](_0x3b749c,_0x1ad7df,_0x5659a9);for(const _0x4530ef of _0x5659a9){for(let _0x4a56c5=0x0;_0x4a56c5<_0x4530ef[_0xc22016(0x182)];++_0x4a56c5){const _0x48e3dc={'preventDefault':()=>{},'stopPropagation':()=>{},'currentTarget':$('<div\x20class=\x22item\x22\x20data-item-id=\x22'+_0x4530ef['item'][_0xc22016(0x199)]+_0xc22016(0x193))[0x0]};if(typeof BetterRolls!==_0xc22016(0x15e)){const _0x31ff42=new Event(_0xc22016(0x17d));_0x31ff42[_0xc22016(0x184)]=![],_0x31ff42[_0xc22016(0x195)]=![],_0x31ff42['altKey']=![];const _0xb8822a={'adv':0x0,'disadv':0x0,'event':_0x31ff42};!game['settings']['get']('betterrolls5e',_0xc22016(0x18d))?_0x4530ef[_0xc22016(0x1a4)][_0xc22016(0x16f)][_0xc22016(0x198)][_0xc22016(0x163)](_0x48e3dc):await BetterRolls[_0xc22016(0x1bc)](_0x4530ef['item'],mergeObject(_0xb8822a,{'preset':0x0}))[_0xc22016(0x169)]();}else await _0x4530ef['item']['roll']();if(game[_0xc22016(0x19f)][_0xc22016(0x1aa)](_0xc22016(0x189))?.[_0xc22016(0x160)]){if(_0x4a56c5<_0x4530ef[_0xc22016(0x182)])await MiscUtil['pDelay'](0x14d);}}}}static[_0x31302b(0x18c)](_0x21b7a5,_0x24d272,_0x4a07c8){_0x24d272['forEach'](_0x2e9d8b=>{const _0x5674b=_0x318a;let _0x240851=Util[_0x5674b(0x174)](_0x2e9d8b);while((Util[_0x5674b(0x17c)](_0x240851[0x0])||Util[_0x5674b(0x176)](_0x240851[0x0]))&&_0x240851[_0x5674b(0x191)])_0x240851[_0x5674b(0x1a3)]();_0x240851=_0x240851[_0x5674b(0x19e)](_0x4ec1a6=>_0x4ec1a6['trim']())['filter'](Boolean);const _0x5f2af5=[];let _0x240ca3=[],_0x44f6b1={};const _0x1b33d7=()=>{const _0x1cc552=_0x5674b;if(!_0x240ca3['length'])return;while(_0x240ca3[_0x1cc552(0x191)]){if(StrUtil[_0x1cc552(0x17b)]['includes'](_0x240ca3[_0x1cc552(0x168)]()))_0x240ca3[_0x1cc552(0x17a)]();else break;}_0x5f2af5[_0x1cc552(0x19d)]({'name':_0x240ca3[_0x1cc552(0x1a5)]('\x20'),'count':_0x44f6b1['count']||0x1}),_0x240ca3=[],_0x44f6b1={};};for(let _0x3d2b48=0x0;_0x3d2b48<_0x240851[_0x5674b(0x191)];++_0x3d2b48){const _0x1a6ea6=_0x240851[_0x3d2b48];if(Util[_0x5674b(0x176)](_0x1a6ea6))_0x240ca3[_0x5674b(0x19d)](_0x1a6ea6);else{if(_0x240ca3[_0x5674b(0x191)]&&StrUtil['TITLE_LOWER_WORDS'][_0x5674b(0x15b)](_0x1a6ea6))_0x240ca3[_0x5674b(0x19d)](_0x1a6ea6);else{const _0x410076=Consts[_0x5674b(0x1ad)]['find'](_0x5369d6=>{const _0x52c6f3=_0x5674b,_0x4be0d6=_0x240851[_0x52c6f3(0x1a9)](_0x3d2b48,_0x3d2b48+_0x5369d6[_0x52c6f3(0x1b1)][_0x52c6f3(0x191)]);return CollectionUtil[_0x52c6f3(0x1b9)](_0x5369d6[_0x52c6f3(0x1b1)],_0x4be0d6);});_0x240ca3['length']&&_0x410076&&(_0x3d2b48+=_0x410076['tokens'][_0x5674b(0x191)]-0x1,_0x44f6b1[_0x5674b(0x182)]=_0x410076[_0x5674b(0x182)]),_0x1b33d7();}}}_0x1b33d7(),_0x5f2af5[_0x5674b(0x154)](_0x31707a=>{const _0x20b631=_0x5674b,_0x125d6c=_0x31707a['name'][_0x20b631(0x18f)]()['trim']();if(_0x125d6c['includes']('multiattack'))return;const _0x5a16f2=_0x21b7a5[_0x20b631(0x19c)][_0x20b631(0x158)](_0x2c801e=>Util[_0x20b631(0x1b2)](_0x2c801e[_0x20b631(0x18e)])[_0x20b631(0x18f)]()===_0x125d6c);if(!_0x5a16f2)return;_0x4a07c8['push']({'item':_0x5a16f2,'count':_0x31707a['count']||0x1});});});}static[_0x31302b(0x1b3)](_0xecb2b6,_0x5c8b08,_0x22647c){const _0x1d1b01=_0x31302b;_0x5c8b08[_0x1d1b01(0x154)](_0x3d3c65=>{const _0x1c6844=_0x1d1b01;_0x3d3c65=_0x3d3c65[_0x1c6844(0x180)](/(one|two|three|four|five|six|seven|eight) (.*?) attacks?/gi,(..._0x3e484b)=>{const _0x12ae61=_0x1c6844,_0x23046e=_0x3e484b[0x1]['toLowerCase'](),_0x4b1d97=Parser[_0x12ae61(0x1b6)](_0x23046e),_0x5743ae=Util[_0x12ae61(0x1b2)](_0x3e484b[0x2])[_0x12ae61(0x18f)]();if(_0x5743ae[_0x12ae61(0x15b)](_0x12ae61(0x1b8)))return'';if(_0x5743ae===_0x12ae61(0x1a2)||_0x5743ae===_0x12ae61(0x170))return this['_pHandleCreateChatMessage_handleMeleeRangedAttacks'](_0xecb2b6,_0x5743ae,_0x4b1d97,_0x22647c),'';const _0x3b8739=_0xecb2b6['items']['find'](_0x16ac5c=>Util[_0x12ae61(0x1b2)](_0x16ac5c['name'])[_0x12ae61(0x18f)]()===_0x5743ae);if(!_0x3b8739)return _0x3e484b[0x0];return _0x22647c[_0x12ae61(0x19d)]({'item':_0x3b8739,'count':_0x4b1d97}),'';}),_0x3d3c65=_0x3d3c65[_0x1c6844(0x180)](/makes (one|two|three|four|five|six|seven|eight) attacks? with its (.*?(?: or .*?)?)$/gi,(..._0x37c8a1)=>{const _0x484b27=_0x1c6844,_0x58e820=_0x37c8a1[0x1];let _0x337d84=_0x37c8a1[0x2];const _0x134ec1=Util['getTokens'](_0x337d84);while(_0x134ec1['length']){const _0x5edc95=[];for(let _0x32be47=0x0;_0x32be47<_0x134ec1[_0x484b27(0x191)];++_0x32be47){const _0x7b5c68=_0x134ec1[_0x32be47][_0x484b27(0x18f)]();if(_0x7b5c68===_0x484b27(0x1b5)||_0x7b5c68==='or'||_0x7b5c68===_0x484b27(0x186)||_0x7b5c68===_0x484b27(0x1a1)||Util[_0x484b27(0x17c)](_0x7b5c68)){_0x134ec1[_0x484b27(0x1a3)]();break;}else _0x5edc95[_0x484b27(0x19d)](_0x134ec1['shift']()),_0x32be47--;}if(_0x5edc95[_0x484b27(0x191)]){const _0x5223c4=_0x5edc95[_0x484b27(0x1a5)]('')[_0x484b27(0x16a)]();if(_0x5223c4[_0x484b27(0x18f)]()['includes'](_0x484b27(0x1b8)))continue;const _0x3cae63=this[_0x484b27(0x1b0)](_0xecb2b6,_0x5223c4);_0x3cae63&&_0x22647c['push']({'item':_0x3cae63,'count':Parser[_0x484b27(0x1b6)](_0x58e820)});}}return _0x134ec1[_0x484b27(0x1a5)]('')[_0x484b27(0x16a)]();}),_0x3d3c65=_0x3d3c65['replace'](/makes (?:two|three|four|five|six|seven|eight) attacks:(.*?)$/gi,(..._0x445659)=>{const _0x413cc8=_0x1c6844;let _0x48cf80=_0x445659[0x1],_0xb6c58e=![],_0x23448b=null;while(_0x48cf80['length']&&_0x48cf80!==_0x23448b){_0x23448b=_0x48cf80,_0x48cf80=_0x48cf80[_0x413cc8(0x180)](/(one|two|three|four|five|six|seven|eight) with (?:its |his |her )(.*)/gi,(..._0x1d5037)=>{const _0x4b4fb1=_0x413cc8,_0x3f3a8a=_0x1d5037[0x1],_0x340738=_0x1d5037[0x2],_0x2edf89=[],_0x1fdb00=Util[_0x4b4fb1(0x174)](_0x340738);for(let _0x576bb0=0x0;_0x576bb0<_0x1fdb00['length'];++_0x576bb0){const _0x5c1d40=_0x1fdb00[_0x576bb0][_0x4b4fb1(0x18f)]();if(_0x5c1d40==='and'||_0x5c1d40==='or'||Util['isPunctuation'](_0x5c1d40)){_0x1fdb00[_0x4b4fb1(0x1a3)]();break;}else _0x2edf89[_0x4b4fb1(0x19d)](_0x1fdb00[_0x4b4fb1(0x1a3)]()),_0x576bb0--;}if(_0x2edf89[_0x4b4fb1(0x191)]){const _0xb0512=_0x2edf89[_0x4b4fb1(0x1a5)]('')[_0x4b4fb1(0x16a)]();if(_0xb0512[_0x4b4fb1(0x18f)]()[_0x4b4fb1(0x15b)](_0x4b4fb1(0x1b8)))return _0x1fdb00[_0x4b4fb1(0x1a5)]('')['trim']();const _0x3c79db=this[_0x4b4fb1(0x1b0)](_0xecb2b6,_0xb0512);_0x3c79db&&_0x22647c[_0x4b4fb1(0x19d)]({'item':_0x3c79db,'count':Parser[_0x4b4fb1(0x1b6)](_0x3f3a8a)});}return _0x1fdb00[_0x4b4fb1(0x1a5)]('')['trim']();});}if(_0xb6c58e)return'';return _0x445659[0x0];});});}static[_0x31302b(0x183)](_0x39d9df,_0x25fb95,_0x3fb351,_0x2339a1){const _0x5c0561=_0x31302b;let _0xd36b49;const _0x276577=[],_0x28a8cb=[];_0x39d9df[_0x5c0561(0x19c)][_0x5c0561(0x19a)](_0x249382=>_0x249382[_0x5c0561(0x1ba)]===_0x5c0561(0x155))[_0x5c0561(0x154)](_0x46e4fc=>{const _0x564e44=_0x5c0561,_0x4e27ce=MiscUtil['get'](_0x46e4fc,_0x564e44(0x16c),'data');if(!_0x4e27ce)return;const _0x2b0d2b=MiscUtil[_0x564e44(0x1aa)](_0x4e27ce,_0x564e44(0x162));switch(_0x2b0d2b){case'simpleM':case _0x564e44(0x1a0):{_0x276577[_0x564e44(0x19d)](_0x46e4fc);if(MiscUtil['get'](_0x4e27ce,_0x564e44(0x1ac),_0x564e44(0x171)))_0x28a8cb[_0x564e44(0x19d)](_0x46e4fc);return;}case _0x564e44(0x1b4):case'martialR':{_0x28a8cb[_0x564e44(0x19d)](_0x46e4fc);return;}}const _0x51db0f=MiscUtil['get'](_0x4e27ce,_0x564e44(0x1a8));switch(_0x51db0f){case _0x564e44(0x159):{_0x276577[_0x564e44(0x19d)](_0x46e4fc);if(MiscUtil[_0x564e44(0x1aa)](_0x4e27ce,_0x564e44(0x1ac),_0x564e44(0x171)))_0x28a8cb['push'](_0x46e4fc);return;}case _0x564e44(0x167):{_0x28a8cb['push'](_0x46e4fc);return;}}const _0x40627f=(MiscUtil[_0x564e44(0x1aa)](_0x4e27ce,_0x564e44(0x187),'value')||'')[_0x564e44(0x180)](/[^a-zA-Z0-9:.,()]/g,'')['replace'](/\s+/g,'\x20')['trim']();if(/melee or ranged weapon attack:/i[_0x564e44(0x15c)](_0x40627f))_0x276577[_0x564e44(0x19d)](_0x46e4fc),_0x28a8cb[_0x564e44(0x19d)](_0x46e4fc);else{if(/melee weapon attack:/i[_0x564e44(0x15c)](_0x40627f))_0x276577['push'](_0x46e4fc);else/ranged weapon attack:/i[_0x564e44(0x15c)](_0x40627f)&&_0x28a8cb[_0x564e44(0x19d)](_0x46e4fc);}});const _0x2062bc=_0x25fb95===_0x5c0561(0x1a2)?_0x276577:_0x28a8cb;_0xd36b49=_0x2062bc[_0x5c0561(0x19e)](_0x4bec77=>{const _0x27fc1e=_0x5c0561,_0xcef1a6=MiscUtil[_0x27fc1e(0x1aa)](_0x4bec77,_0x27fc1e(0x16c),_0x27fc1e(0x16c),_0x27fc1e(0x1b7),_0x27fc1e(0x185));if(!_0xcef1a6)return null;const _0x2db1f3=_0xcef1a6[_0x27fc1e(0x19e)](_0x2a2137=>{const _0xb051a8=_0x27fc1e;try{const _0x3d811c=_0x2a2137[0x0][_0xb051a8(0x180)](/@mod/gi,()=>{const _0x4d3645=_0xb051a8,_0x44a5f9=_0x4bec77[_0x4d3645(0x18a)];if(!_0x44a5f9)return 0x0;const _0x2410ea=MiscUtil[_0x4d3645(0x1aa)](_0x39d9df,_0x4d3645(0x16c),_0x4d3645(0x16c),_0x4d3645(0x15a),'value')||0xa;return Parser[_0x4d3645(0x194)](_0x2410ea);}),_0x2d7139=Renderer[_0xb051a8(0x196)][_0xb051a8(0x156)][_0xb051a8(0x1a7)](_0xb051a8(0x16e)+_0x3d811c+')');return{'type':_0x2a2137[0x1],'meanDamage':_0x2d7139['tree'][_0xb051a8(0x164)]({})};}catch(_0x5342d9){return console['error'](...LGT,_0xb051a8(0x15d)+_0x2a2137[0x0]+'\x22',_0x5342d9),null;}})[_0x27fc1e(0x19a)](Boolean);if(!_0x2db1f3[_0x27fc1e(0x191)])return null;const _0x174a30={};_0x2db1f3[_0x27fc1e(0x154)](_0x3bba3d=>_0x174a30[_0x3bba3d['type']]=Math[_0x27fc1e(0x190)](_0x3bba3d[_0x27fc1e(0x166)],_0x174a30[_0x3bba3d[_0x27fc1e(0x1ba)]]||0x0));const _0xb6b72d=Object[_0x27fc1e(0x197)](_0x174a30)[_0x27fc1e(0x175)]((_0x59b876,_0x4f2bfa)=>_0x59b876+_0x4f2bfa,0x0);return{'item':_0x4bec77,'meanDamage':_0xb6b72d};})[_0x5c0561(0x19a)](Boolean)[_0x5c0561(0x15f)]((_0x43eb13,_0x273557)=>SortUtil[_0x5c0561(0x1af)](_0x273557[_0x5c0561(0x166)],_0x43eb13['meanDamage']))[_0x5c0561(0x19e)](_0x4d50d4=>_0x4d50d4[_0x5c0561(0x1a4)])['find'](Boolean);if(!_0xd36b49&&_0x2062bc[0x0])_0xd36b49=_0x2062bc[0x0];else{if(!_0xd36b49&&!_0x2062bc[0x0])return;}_0x2339a1[_0x5c0561(0x19d)]({'item':_0xd36b49,'count':_0x3fb351});}static[_0x31302b(0x1b0)](_0x1fc844,_0x432d96){const _0x4340e2=_0x31302b;let _0x15f2e9=_0x1fc844[_0x4340e2(0x19c)]['find'](_0x9f8b3c=>Util[_0x4340e2(0x1b2)](_0x9f8b3c[_0x4340e2(0x18e)])[_0x4340e2(0x18f)]()===_0x432d96);if(!_0x15f2e9&&_0x432d96[_0x4340e2(0x1ab)]('s')){const _0x57edae=_0x432d96[_0x4340e2(0x1a9)](0x0,-0x1);_0x15f2e9=_0x1fc844[_0x4340e2(0x19c)][_0x4340e2(0x158)](_0x56ebd9=>Util['getWithoutParens'](_0x56ebd9['name'])[_0x4340e2(0x18f)]()===_0x57edae);}return _0x15f2e9;}}export{ActorMultiattack};