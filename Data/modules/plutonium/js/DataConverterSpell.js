const _0x4e2f=['items','label','escapeQuotes','map','entriesHigherLevel','flat','hour','isAddPermission','durationAmount','getSrdCompendiumEntity','getCleanEntityName','copy','meta','usesCurrent','VET_SPELL_SCHOOL_TO_ABV','melee\x20spell\x20attack','scaling','time','doHookSpellLinkRender','components','PG_SPELLS','MODULE_NAME','target','self','instant','getNameWithSourcePart','LINK_DATA_SHEET_ITEM','util','error','cost','optsGetSpellItem','level','heal','permission','OwnedItem','target.value','miscTags','scalingLevelDice','isStrictMatching','hashToIdMap','turn','split','min','type','durationUnit','range','sphere','isIgnoreExisting','healing','exec','getItemSource','year','modules/','spell','filter','round','hash','_id','join','preparationMode','keys','toLowerCase','pGetSpellHashToItemPosMapAndFillSpellsFromTagIds','stringify','encodeForHash','pGetSpellItem','usesMax','pGetCompendiumImage','stripTags','ritual','find','touch','isPrepared','permanent','isTemporary','_pGetAdditionalData','pGetSpellHashToItemPosMapAndFillSpells','length','day','when\x20you\x20reach\x205th\x20level','amount','page','miles','timed','pGetIconImage','createEmbeddedEntity','condition','importSpell','unit','school','source','getMetricNumber','minute','usesPer','damageInflict','inst','pGetSpellAdditionalData','cantrip','hashPreEncoded','replace','perm','pCacheAndGet','URL_TO_HASH_BUILDER','\x20+\x20@mod','foundrySpell','abilityAbv','duration','spec','get','permissions','prepared','import','href','_pFillSpellPromises_pAddSpellItem','distance','savingThrow','some','rsak','ranged\x20spell\x20attack','none','hover','push','concentration','data','name','includes'];(function(_0x4cf4bd,_0x4e2f65){const _0x3b3faf=function(_0x34175c){while(--_0x34175c){_0x4cf4bd['push'](_0x4cf4bd['shift']());}};_0x3b3faf(++_0x4e2f65);}(_0x4e2f,0x1a7));const _0x3b3f=function(_0x4cf4bd,_0x4e2f65){_0x4cf4bd=_0x4cf4bd-0x0;let _0x3b3faf=_0x4e2f[_0x4cf4bd];return _0x3b3faf;};import{Vetools}from'./Vetools.js';import{UtilActors}from'./UtilActors.js';import{Config}from'./Config.js';import{SharedConsts}from'../shared/SharedConsts.js';import{UtilApplications}from'./UtilApplications.js';import{LGT}from'./Util.js';import{UtilEvents}from'./UtilEvents.js';import{DataConverter}from'./DataConverter.js';class DataConverterSpell{static async[_0x3b3f('0x14')](_0x4270de,_0x1e4fbc){_0x1e4fbc=_0x1e4fbc||{};const _0x4cb1a4=DataConverter['getEntryDescription'](_0x4270de),_0x5da592=_0x4270de['entriesHigherLevel']?DataConverter['getEntryDescription'](_0x4270de,{'prop':_0x3b3f('0x55')}):'',_0x219f95=[_0x4cb1a4,_0x5da592]['filter'](Boolean)[_0x3b3f('0xd')](''),_0x25c527=JSON[_0x3b3f('0x12')](_0x4270de['entries']);let _0x1c3fb7='';if(_0x4270de[_0x3b3f('0x75')]&&_0x4270de[_0x3b3f('0x75')][_0x3b3f('0x50')]('HL'))_0x1c3fb7=_0x3b3f('0x71');if(_0x4270de[_0x3b3f('0x46')]&&_0x4270de[_0x3b3f('0x46')]['length'])_0x1c3fb7='save';if(_0x25c527[_0x3b3f('0x10')]()[_0x3b3f('0x50')](_0x3b3f('0x60')))_0x1c3fb7='msak';if(_0x25c527[_0x3b3f('0x10')]()['includes'](_0x3b3f('0x49')))_0x1c3fb7=_0x3b3f('0x48');_0x1c3fb7=_0x1c3fb7||_0x3b3f('0x6c');const _0x22418f=UtilActors[_0x3b3f('0x5f')][_0x4270de[_0x3b3f('0x2c')]]||'',_0xd73f23=_0x4270de['components']&&_0x4270de[_0x3b3f('0x64')]['m']?_0x4270de[_0x3b3f('0x64')]['m']!==!![]?''+(_0x4270de[_0x3b3f('0x64')]['m']['text']||_0x4270de['components']['m']):'':'';let _0x3c931e=0x0,_0x2036f8='';const _0x50dc1c=_0x4270de[_0x3b3f('0x3d')][0x0];switch(_0x50dc1c[_0x3b3f('0x7c')]){case _0x3b3f('0x69'):_0x2036f8=_0x3b3f('0x32');break;case _0x3b3f('0x26'):{switch(_0x50dc1c['duration'][_0x3b3f('0x7c')]){case _0x3b3f('0x79'):_0x2036f8=_0x3b3f('0x79'),_0x3c931e=_0x50dc1c[_0x3b3f('0x3d')]['amount'];break;case'round':_0x2036f8=_0x3b3f('0xa'),_0x3c931e=_0x50dc1c[_0x3b3f('0x3d')]['amount'];break;case _0x3b3f('0x2f'):_0x2036f8=_0x3b3f('0x2f'),_0x3c931e=_0x50dc1c[_0x3b3f('0x3d')][_0x3b3f('0x23')];break;case _0x3b3f('0x57'):_0x2036f8=_0x3b3f('0x57'),_0x3c931e=_0x50dc1c[_0x3b3f('0x3d')][_0x3b3f('0x23')];break;case _0x3b3f('0x21'):_0x2036f8=_0x3b3f('0x21'),_0x3c931e=_0x50dc1c['duration'][_0x3b3f('0x23')];break;case'week':_0x2036f8=_0x3b3f('0x21'),_0x3c931e=_0x50dc1c['duration'][_0x3b3f('0x23')]*0x7;break;case _0x3b3f('0x6'):_0x2036f8=_0x3b3f('0x6'),_0x3c931e=_0x50dc1c[_0x3b3f('0x3d')][_0x3b3f('0x23')];break;}break;}case _0x3b3f('0x1c'):_0x2036f8=_0x3b3f('0x37');break;case'special':_0x2036f8=_0x3b3f('0x3e');break;}let _0x20d4f9=0x0,_0x250fad='',_0x11e094=0x0,_0x52e82c='',_0x500ba7='';switch(_0x4270de[_0x3b3f('0x0')]['type']){case RNG_SPECIAL:_0x250fad=_0x3b3f('0x3e');break;case RNG_POINT:{const _0x4a348f=_0x4270de[_0x3b3f('0x0')][_0x3b3f('0x45')];switch(_0x4a348f[_0x3b3f('0x7c')]){case RNG_SELF:{_0x52e82c=_0x3b3f('0x68'),_0x500ba7=_0x3b3f('0x68'),_0x250fad=_0x3b3f('0x68');break;}case RNG_UNLIMITED:case RNG_UNLIMITED_SAME_PLANE:case RNG_SIGHT:case RNG_SPECIAL:{_0x52e82c=_0x3b3f('0x3e'),_0x250fad=_0x3b3f('0x3e');break;}case RNG_TOUCH:{_0x52e82c=_0x3b3f('0x1a'),_0x250fad=_0x3b3f('0x1a');break;}case UNT_MILES:{_0x20d4f9=Config[_0x3b3f('0x2e')](_0x3b3f('0x2a'),_0x4a348f[_0x3b3f('0x23')],UNT_MILES),_0x250fad='mi';break;}case UNT_FEET:default:{_0x20d4f9=Config['getMetricNumber']('importSpell',_0x4a348f[_0x3b3f('0x23')],UNT_FEET),_0x250fad='ft';break;}}break;}case RNG_LINE:case RNG_CUBE:case RNG_CONE:case RNG_RADIUS:case RNG_SPHERE:case RNG_HEMISPHERE:case RNG_CYLINDER:{_0x11e094=Config[_0x3b3f('0x2e')](_0x3b3f('0x2a'),_0x4270de[_0x3b3f('0x0')]['distance'][_0x3b3f('0x23')],_0x4270de[_0x3b3f('0x0')][_0x3b3f('0x45')][_0x3b3f('0x7c')]);if(_0x4270de[_0x3b3f('0x0')][_0x3b3f('0x45')][_0x3b3f('0x7c')]===_0x3b3f('0x25'))_0x52e82c='mi';else _0x52e82c='ft';if(_0x4270de[_0x3b3f('0x0')][_0x3b3f('0x7c')]===RNG_HEMISPHERE)_0x500ba7=_0x3b3f('0x1');else _0x500ba7=_0x4270de[_0x3b3f('0x0')][_0x3b3f('0x7c')];}}let _0xbf8fa0=[],_0x2a07b6=null,_0x24c753=null;if(_0x4270de[_0x3b3f('0x76')]){const _0x58ad9b=[_0x4270de['scalingLevelDice']][_0x3b3f('0x56')](),_0x711eb7=_0x14be8f=>Math[_0x3b3f('0x7b')](...Object[_0x3b3f('0xf')](_0x14be8f)[_0x3b3f('0x54')](_0x38a3eb=>Number(_0x38a3eb))),_0x12d175=new RegExp('('+UtilActors['VALID_DAMAGE_TYPES'][_0x3b3f('0xd')]('|')+')','i');_0xbf8fa0['push'](..._0x58ad9b['map'](_0x164846=>{const _0x1d1128=_0x711eb7(_0x164846[_0x3b3f('0x61')]),_0x27fb4b=_0x164846['scaling'][_0x1d1128],_0x3a0482=_0x12d175['exec'](_0x164846[_0x3b3f('0x52')]||'');return[(_0x27fb4b||'')[_0x3b3f('0x36')](/{{spellcasting_mod}}/g,'@mod'),_0x3a0482?_0x3a0482[0x1][_0x3b3f('0x10')]():null];}));const _0x3fcdf5=_0x58ad9b[0x0],_0x5ca683=_0x711eb7(_0x3fcdf5[_0x3b3f('0x61')]);_0x2a07b6=_0x3fcdf5[_0x3b3f('0x61')][_0x5ca683];}else{const _0x2c6e8f=[];if(_0x4270de[_0x3b3f('0x31')]&&_0x4270de[_0x3b3f('0x31')][_0x3b3f('0x20')]){if(_0x25c527['toLowerCase']()[_0x3b3f('0x50')](_0x3b3f('0x22'))){const _0x1a7dee=[];_0x25c527[_0x3b3f('0x36')](/\({@damage ([^}]+)}\)/g,(..._0x425fad)=>_0x1a7dee[_0x3b3f('0x4c')](_0x425fad[0x1]));if(_0x1a7dee[_0x3b3f('0x20')]===0x3){const _0x4a1ec6=/(?:^|[^(]){@damage ([^}]+)}(?:[^)]|$)/[_0x3b3f('0x4')](_0x25c527);if(_0x4a1ec6)_0x2a07b6=_0x4a1ec6[0x1];else _0x2a07b6=_0x1a7dee[0x0];}}_0x25c527[_0x3b3f('0x36')](/{@damage ([^}]+)} ([^ ]+)(, [^ ]+)*(,? or [^ ]+)? damage/ig,(..._0x89b6b4)=>{_0x2c6e8f[_0x3b3f('0x4c')]([_0x89b6b4[0x1],_0x89b6b4[0x2]]);});}if(_0x4270de[_0x3b3f('0x75')]&&_0x4270de[_0x3b3f('0x75')][_0x3b3f('0x47')](_0xa99afe=>_0xa99afe==='HL')){const _0x1c9d18=['',_0x3b3f('0x3')];_0x25c527['replace'](/{@dice ([^}]+)}(\s*\+\s*your\s+spellcasting\s+ability\s+modifier)/i,(..._0x3b377)=>{_0x1c9d18[0x0]=_0x3b377[0x1],_0x3b377[0x1]&&(_0x1c9d18[0x0]=_0x1c9d18[0x0]+_0x3b3f('0x3a'));}),_0x2c6e8f[_0x3b3f('0x4c')](_0x1c9d18);}_0x4270de[_0x3b3f('0x55')]&&JSON[_0x3b3f('0x12')](_0x4270de[_0x3b3f('0x55')])['replace'](/{@(?:scaledice|scaledamage) ([^}]+)}/i,(..._0x54f3bc)=>{const [_0x4e75c1,_0x50442a,_0x53e7f5]=_0x54f3bc[0x1][_0x3b3f('0x7a')]('|');_0x24c753=_0x53e7f5;}),_0xbf8fa0[_0x3b3f('0x4c')](..._0x2c6e8f);}let _0x13abda='';if(_0x4270de['savingThrow']&&_0x4270de[_0x3b3f('0x46')]['length'])_0x13abda=_0x4270de[_0x3b3f('0x46')][0x0]['substring'](0x0,0x3)[_0x3b3f('0x10')]();const _0x3856bb=await DataConverter[_0x3b3f('0x27')](_0x3b3f('0x8'),_0x4270de)||await DataConverter[_0x3b3f('0x16')](_0x3b3f('0x8'),_0x4270de)||_0x3b3f('0x7')+SharedConsts[_0x3b3f('0x66')]+'/media/icon/scroll-unfurled.svg',_0x5de824=await DataConverter[_0x3b3f('0x5a')]('spell',_0x4270de);_0x5de824&&(_0x11e094=MiscUtil[_0x3b3f('0x3f')](_0x5de824,'data',_0x3b3f('0x67'),'value')||_0x11e094,_0x52e82c=MiscUtil[_0x3b3f('0x3f')](_0x5de824,_0x3b3f('0x4e'),_0x3b3f('0x67'),'units')||_0x52e82c,_0x500ba7=MiscUtil[_0x3b3f('0x3f')](_0x5de824,'data','target',_0x3b3f('0x7c'))||_0x500ba7);const _0x1b8716=await this[_0x3b3f('0x1e')](_0x4270de,_0x52e82c);if(_0x1e4fbc[_0x3b3f('0x59')]!==undefined)_0x3c931e=_0x1e4fbc['durationAmount'];if(_0x1e4fbc[_0x3b3f('0x7d')]!==undefined)_0x2036f8=_0x1e4fbc[_0x3b3f('0x7d')];const _0x9691a={'name':UtilApplications[_0x3b3f('0x5b')](DataConverter[_0x3b3f('0x6a')](_0x4270de)),'type':'spell','data':{'source':DataConverter['getSourceWithPagePart'](_0x4270de),'description':{'value':_0x219f95,'chat':'','unidentified':''},'actionType':_0x1c3fb7,'level':_0x4270de[_0x3b3f('0x70')],'school':_0x22418f,'components':{'value':'','vocal':_0x4270de['components']&&_0x4270de['components']['v'],'somatic':_0x4270de['components']&&_0x4270de[_0x3b3f('0x64')]['s'],'material':!!(_0x4270de[_0x3b3f('0x64')]&&_0x4270de[_0x3b3f('0x64')]['m']),'ritual':_0x4270de[_0x3b3f('0x5d')]&&_0x4270de[_0x3b3f('0x5d')][_0x3b3f('0x18')],'concentration':!!MiscUtil['get'](_0x4270de,_0x3b3f('0x3d'),'0',_0x3b3f('0x4d'))},'materials':{'value':_0xd73f23,'consumed':!!MiscUtil['get'](_0x4270de,_0x3b3f('0x64'),'m','consume'),'cost':Math[_0x3b3f('0xa')]((MiscUtil[_0x3b3f('0x3f')](_0x4270de,'components','m',_0x3b3f('0x6e'))||0x0)/0x64),'supply':0x0},'target':{'value':_0x11e094,'units':_0x52e82c,'type':_0x500ba7},'range':{'value':_0x20d4f9,'units':_0x250fad,'long':0x0},'activation':{'type':_0x4270de[_0x3b3f('0x62')][0x0][_0x3b3f('0x2b')],'cost':_0x4270de[_0x3b3f('0x62')][0x0]['number'],'condition':Renderer[_0x3b3f('0x17')](_0x4270de[_0x3b3f('0x62')][0x0][_0x3b3f('0x29')]||'')},'duration':{'value':_0x3c931e,'units':_0x2036f8},'damage':{'parts':_0xbf8fa0[_0x3b3f('0x9')](Boolean),'versatile':''},'scaling':{'mode':_0x2a07b6?_0x3b3f('0x34'):_0x24c753?'level':_0x3b3f('0x4a'),'formula':_0x2a07b6||_0x24c753||''},'save':{'ability':_0x13abda,'dc':null},'ability':_0x1e4fbc[_0x3b3f('0x3c')]||'','uses':{'value':_0x1e4fbc[_0x3b3f('0x5e')]||0x0,'max':_0x1e4fbc[_0x3b3f('0x15')]||0x0,'per':_0x1e4fbc[_0x3b3f('0x30')]||''},'attackBonus':0x0,'chatFlavor':'','critical':null,'formula':'','preparation':{'mode':_0x4270de['level']===0x0?'always':_0x1e4fbc[_0x3b3f('0xe')]||_0x3b3f('0x41'),'prepared':_0x4270de['level']===0x0?!![]:!!_0x1e4fbc[_0x3b3f('0x1b')]},..._0x1b8716||{}},'img':_0x3856bb};if(_0x1e4fbc[_0x3b3f('0x58')])_0x9691a[_0x3b3f('0x72')]={'default':Config[_0x3b3f('0x3f')](_0x3b3f('0x2a'),_0x3b3f('0x40'))};return _0x9691a;}static async[_0x3b3f('0x1e')](_0x688d27,_0x5702db){let _0x46fe13=(MiscUtil[_0x3b3f('0x3f')](BrewUtil,'homebrew',_0x3b3f('0x3b'))||[])[_0x3b3f('0x19')](_0x1d67de=>_0x1d67de[_0x3b3f('0x4f')]===_0x688d27['name']&&_0x1d67de[_0x3b3f('0x2d')]===_0x688d27[_0x3b3f('0x2d')]);if(!_0x46fe13){const _0x4ea677=await Vetools[_0x3b3f('0x33')]();_0x46fe13=_0x4ea677[_0x3b3f('0x8')][_0x3b3f('0x19')](_0x4069c8=>_0x4069c8[_0x3b3f('0x4f')]===_0x688d27['name']&&_0x4069c8[_0x3b3f('0x2d')]===_0x688d27[_0x3b3f('0x2d')]);}if(!_0x46fe13)return null;const _0x59b180=MiscUtil[_0x3b3f('0x5c')](_0x46fe13['data']);if(_0x59b180[_0x3b3f('0x74')])_0x59b180[_0x3b3f('0x74')]=Config['getMetricNumber'](_0x3b3f('0x2a'),_0x59b180[_0x3b3f('0x74')],_0x5702db);return _0x59b180;}static async[_0x3b3f('0x11')](_0x5936ad,_0x4b8567,_0x544fa7){_0x544fa7=_0x544fa7||{};const _0x582256=_0x544fa7[_0x3b3f('0x78')]||{};for(const _0x374521 of _0x4b8567){let [_0x2a7387,_0x2482b1]=_0x374521[_0x3b3f('0x7a')]('|');if(!_0x2482b1)_0x2482b1=SRC_PHB;const _0x3943e5=UrlUtil[_0x3b3f('0x39')][UrlUtil['PG_SPELLS']]({'name':_0x2a7387,'source':_0x2482b1});if(_0x582256[_0x3943e5]!=null)continue;const _0x5169c3=await DataConverterSpell['_pFillSpellPromises_pAddSpellItem'](_0x5936ad,_0x2482b1,_0x3943e5,_0x544fa7);if(_0x5169c3==null)continue;_0x582256[_0x3943e5]=_0x5169c3;}return _0x582256;}static async[_0x3b3f('0x1f')](_0x45cccf,_0x5086b2,_0x23903b){_0x23903b=_0x23903b||{};const _0x3939bc=[],_0x395b56=/{@spell ([^}]+)}/gi;let _0x4e6b8f;while(_0x4e6b8f=_0x395b56[_0x3b3f('0x4')](_0x5086b2)){_0x3939bc[_0x3b3f('0x4c')](_0x4e6b8f[0x1]);}return this['pGetSpellHashToItemPosMapAndFillSpellsFromTagIds'](_0x45cccf,_0x3939bc,_0x23903b);}static async[_0x3b3f('0x44')](_0xb2b40,_0x32c697,_0x293335,_0x520ea6){_0x520ea6=_0x520ea6||{};let _0x2fe222;try{_0x2fe222=await Renderer[_0x3b3f('0x4b')][_0x3b3f('0x38')](UrlUtil['PG_SPELLS'],_0x32c697,_0x293335);}catch(_0x180b03){return console[_0x3b3f('0x6d')](...LGT,'Failed\x20to\x20import\x20spell\x20with\x20hash\x20\x22'+_0x293335+'\x22!',_0x180b03),null;}if(!_0x2fe222)return null;if(!_0x520ea6[_0x3b3f('0x2')]){const _0x1aec6c=DataConverterSpell['getActorSpell'](_0xb2b40,_0x2fe222[_0x3b3f('0x4f')],_0x2fe222[_0x3b3f('0x2d')]);if(_0x1aec6c)return _0x1aec6c[_0x3b3f('0xc')]||_0x1aec6c['data'][_0x3b3f('0xc')];}const _0x482b67=await DataConverterSpell[_0x3b3f('0x14')](_0x2fe222,{..._0x520ea6[_0x3b3f('0x6f')]||{}});if(_0x520ea6[_0x3b3f('0x1d')]){const _0x364e54=await Item['create'](_0x482b67,{'temporary':!![]});(_0xb2b40[_0x3b3f('0x4e')][_0x3b3f('0x51')]=_0xb2b40[_0x3b3f('0x4e')][_0x3b3f('0x51')]||[])[_0x3b3f('0x4c')](_0x364e54);}else{const _0x5bdfc0=await _0xb2b40[_0x3b3f('0x28')](_0x3b3f('0x73'),_0x482b67,{});return _0x5bdfc0[_0x3b3f('0xc')]||_0x5bdfc0['data']['_id'];}}static['getActorSpell'](_0x4fff3d,_0x2f0946,_0x29e207){if(!_0x2f0946||!_0x29e207)return null;return _0x4fff3d[_0x3b3f('0x51')]&&_0x4fff3d[_0x3b3f('0x51')]['find'](_0x563f61=>(_0x563f61[_0x3b3f('0x4f')]||'')[_0x3b3f('0x10')]()===_0x2f0946[_0x3b3f('0x10')]()&&(!Config[_0x3b3f('0x3f')](_0x3b3f('0x42'),_0x3b3f('0x77'))||(DataConverter[_0x3b3f('0x5')](_0x563f61)||'')['toLowerCase']()===_0x29e207[_0x3b3f('0x10')]()));}static[_0x3b3f('0x63')](_0x56b180,_0x30aac4,_0x2ffc7e){if(_0x2ffc7e[_0x3b3f('0x43')]&&_0x2ffc7e[_0x3b3f('0x43')][_0x3b3f('0x4b')]){if(_0x2ffc7e[_0x3b3f('0x43')][_0x3b3f('0x4b')][_0x3b3f('0x24')]===UrlUtil[_0x3b3f('0x65')]){const _0x267858=_0x2ffc7e[_0x3b3f('0x43')][_0x3b3f('0x35')]?_0x2ffc7e['href'][_0x3b3f('0xb')]:UrlUtil[_0x3b3f('0x13')](_0x2ffc7e[_0x3b3f('0x43')][_0x3b3f('0xb')]),_0x4535ce=_0x30aac4[_0x267858];if(_0x4535ce!=null){const _0x2fdc92=JSON[_0x3b3f('0x12')]({'actorId':_0x56b180,'itemId':_0x4535ce})[_0x3b3f('0x53')]();return{'isDisableEvents':!![],'string':UtilEvents[_0x3b3f('0x6b')]+'=\x22'+_0x2fdc92+'\x22'};}}}return null;}}export{DataConverterSpell};